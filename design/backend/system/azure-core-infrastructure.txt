# Azure Cloud ê¸°ë°˜ ì—¬í–‰ ì¼ì • ìƒì„± ì„œë¹„ìŠ¤ - í•µì‹¬ ì¸í”„ë¼ ì•„í‚¤í…ì²˜

## ğŸ¯ ì„¤ê³„ ê°œìš”

### ëª©í‘œ
- ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ ê¸°ë°˜ Azure ë„¤ì´í‹°ë¸Œ í´ë¼ìš°ë“œ ì¸í”„ë¼ êµ¬ì„±
- ì»¨í…Œì´ë„ˆ ê¸°ë°˜ ì„œë¹„ìŠ¤ ë°°í¬ì™€ ì„œë²„ë¦¬ìŠ¤ ì»´í“¨íŒ… í•˜ì´ë¸Œë¦¬ë“œ í™œìš©
- ê³ ê°€ìš©ì„±, í™•ì¥ì„±, ì„±ëŠ¥ ìµœì í™”ë¥¼ ë™ì‹œì— ë§Œì¡±í•˜ëŠ” ì¸í”„ë¼ ì„¤ê³„

### ì„¤ê³„ ì›ì¹™
1. **í´ë¼ìš°ë“œ ë„¤ì´í‹°ë¸Œ**: Azure ê´€ë¦¬í˜• ì„œë¹„ìŠ¤ ìš°ì„  í™œìš©
2. **ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤**: ì„œë¹„ìŠ¤ë³„ ë…ë¦½ì  ë°°í¬ ë° í™•ì¥
3. **ë°ì´í„° ë…ë¦½ì„±**: ì„œë¹„ìŠ¤ë³„ ì „ìš© ë°ì´í„° ì €ì¥ì†Œ
4. **API First**: API Gateway ì¤‘ì‹¬ì˜ í†µì‹  êµ¬ì¡°
5. **ìºì‹œ ìš°ì„ **: Redisë¥¼ í†µí•œ ì„±ëŠ¥ ìµœì í™”
6. **ë¹„ìš© ìµœì í™”**: ì‚¬ìš©ëŸ‰ ê¸°ë°˜ ìŠ¤ì¼€ì¼ë§

---

## ğŸ—ï¸ ì „ì²´ ì•„í‚¤í…ì²˜ ê°œìš”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Azure Cloud Platform                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Azure Front   â”‚    â”‚            Azure API Management          â”‚ â”‚
â”‚  â”‚     Door        â”‚ -> â”‚         (API Gateway Pattern)            â”‚ â”‚
â”‚  â”‚    (Global)     â”‚    â”‚                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                           â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Azure Container Apps Environment                    â”‚ â”‚
â”‚  â”‚                                         â”‚                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  Profile    â”‚ â”‚ Itinerary   â”‚ â”‚  Location   â”‚ â”‚   MCP      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Service    â”‚ â”‚  Service    â”‚ â”‚  Service    â”‚ â”‚  Proxy     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ (Container) â”‚ â”‚ (Container) â”‚ â”‚ (Container) â”‚ â”‚(Function)  â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                           â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                 Data Tier               â”‚                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚   Profile DB    â”‚ â”‚  Itinerary DB   â”‚ â”‚   Location DB       â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  (PostgreSQL)   â”‚ â”‚  (PostgreSQL)   â”‚ â”‚  (PostgreSQL)       â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  Redis Cache    â”‚ â”‚  Service Bus    â”‚ â”‚   Blob Storage      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚   (Premium)     â”‚ â”‚   (Premium)     â”‚ â”‚    (Standard)       â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¢ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë³„ Azure ì„œë¹„ìŠ¤ ë§¤í•‘

### 1. í”„ë¡œíŒŒì¼ ì„œë¹„ìŠ¤ (Profile Service)

| ì»´í¬ë„ŒíŠ¸ | Azure ì„œë¹„ìŠ¤ | SKU/ê³„ì¸µ | ìš©ë„ |
|---------|-------------|----------|-----|
| ì• í”Œë¦¬ì¼€ì´ì…˜ | Azure Container Apps | 0.25 vCPU, 0.5Gi RAM | Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ |
| ë°ì´í„°ë² ì´ìŠ¤ | Azure Database for PostgreSQL | GP 2 vCore, 32GB Storage | í”„ë¡œíŒŒì¼/ì—¬í–‰ ë°ì´í„° ì €ì¥ |
| ìºì‹œ | Azure Cache for Redis | Standard C1 (1GB) | ì„¸ì…˜/í”„ë¡œíŒŒì¼ ìºì‹œ |
| ë©”ì‹œì§• | Azure Service Bus | Standard | í”„ë¡œíŒŒì¼ ë³€ê²½ ì´ë²¤íŠ¸ |

**ë°°í¬ êµ¬ì„±**:
```yaml
# profile-service-container-app.yaml
properties:
  environmentId: /subscriptions/{subscription}/resourceGroups/tripgen-rg/providers/Microsoft.App/managedEnvironments/tripgen-env
  configuration:
    ingress:
      external: false
      targetPort: 8080
    secrets:
      - name: db-connection-string
        value: postgresql://profile-db.postgres.database.azure.com:5432/profiledb
  template:
    containers:
      - image: tripgen.azurecr.io/profile-service:latest
        name: profile-service
        resources:
          cpu: 0.25
          memory: 0.5Gi
        env:
          - name: SPRING_DATASOURCE_URL
            secretRef: db-connection-string
          - name: REDIS_HOST
            value: tripgen-cache.redis.cache.windows.net
    scale:
      minReplicas: 1
      maxReplicas: 10
      rules:
        - name: http-rule
          http:
            metadata:
              concurrentRequests: '10'
```

### 2. ì¼ì • ì„œë¹„ìŠ¤ (Itinerary Service)

| ì»´í¬ë„ŒíŠ¸ | Azure ì„œë¹„ìŠ¤ | SKU/ê³„ì¸µ | ìš©ë„ |
|---------|-------------|----------|-----|
| ì• í”Œë¦¬ì¼€ì´ì…˜ | Azure Container Apps | 0.5 vCPU, 1Gi RAM | Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ |
| ë°ì´í„°ë² ì´ìŠ¤ | Azure Database for PostgreSQL | GP 4 vCore, 64GB Storage | ì¼ì •/í™œë™ ë°ì´í„° ì €ì¥ |
| Job Queue | Azure Service Bus | Premium | AI ì¼ì • ìƒì„± ì‘ì—… í |
| íŒŒì¼ ì €ì¥ì†Œ | Azure Blob Storage | Hot Tier | ì‚¬ì§„/ì²¨ë¶€íŒŒì¼ ì €ì¥ |

**ë°°í¬ êµ¬ì„±**:
```yaml
# itinerary-service-container-app.yaml
properties:
  template:
    containers:
      - image: tripgen.azurecr.io/itinerary-service:latest
        name: itinerary-service
        resources:
          cpu: 0.5
          memory: 1Gi
    scale:
      minReplicas: 2
      maxReplicas: 20
      rules:
        - name: service-bus-rule
          azureQueue:
            queueName: ai-itinerary-queue
            queueLength: '5'
```

### 3. ì¥ì†Œ ì„œë¹„ìŠ¤ (Location Service)

| ì»´í¬ë„ŒíŠ¸ | Azure ì„œë¹„ìŠ¤ | SKU/ê³„ì¸µ | ìš©ë„ |
|---------|-------------|----------|-----|
| ì• í”Œë¦¬ì¼€ì´ì…˜ | Azure Container Apps | 0.25 vCPU, 0.5Gi RAM | Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ |
| ë°ì´í„°ë² ì´ìŠ¤ | Azure Database for PostgreSQL | GP 2 vCore, 32GB Storage + PostGIS | ì¥ì†Œ ë°ì´í„° ë° ê³µê°„ ì •ë³´ |
| ìºì‹œ | Azure Cache for Redis | Premium P1 (6GB) | ì¥ì†Œ ì •ë³´ ë° ê²€ìƒ‰ ê²°ê³¼ ìºì‹œ |
| ë²ˆì—­ ì„œë¹„ìŠ¤ | Azure Translator | S1 Standard | ë‹¤êµ­ì–´ ì¥ì†Œëª… ë²ˆì—­ |

### 4. MCP í”„ë¡ì‹œ (ì™¸ë¶€ API í†µí•©)

| ì»´í¬ë„ŒíŠ¸ | Azure ì„œë¹„ìŠ¤ | SKU/ê³„ì¸µ | ìš©ë„ |
|---------|-------------|----------|-----|
| í”„ë¡ì‹œ í•¨ìˆ˜ | Azure Functions | Premium EP1 | ì¹´ì¹´ì˜¤/êµ¬ê¸€ MCP API í”„ë¡ì‹œ |
| API ê´€ë¦¬ | Azure API Management | Developer | ì™¸ë¶€ API í†µí•© ë° ê´€ë¦¬ |
| í‚¤ ì €ì¥ì†Œ | Azure Key Vault | Standard | API í‚¤ ë° ë¹„ë°€ ê´€ë¦¬ |

**í•¨ìˆ˜ ë°°í¬ êµ¬ì„±**:
```javascript
// mcp-proxy-function/index.js
module.exports = async function (context, req) {
    const { provider, endpoint, params } = req.body;
    
    try {
        let apiKey, baseUrl;
        
        if (provider === 'kakao') {
            apiKey = process.env.KAKAO_API_KEY;
            baseUrl = 'https://dapi.kakao.com';
        } else if (provider === 'google') {
            apiKey = process.env.GOOGLE_API_KEY;
            baseUrl = 'https://maps.googleapis.com';
        }
        
        const response = await fetch(`${baseUrl}${endpoint}?key=${apiKey}&${new URLSearchParams(params)}`);
        const data = await response.json();
        
        context.res = {
            status: 200,
            body: data
        };
    } catch (error) {
        context.log.error('MCP Proxy Error:', error);
        context.res = {
            status: 500,
            body: { error: 'External API call failed' }
        };
    }
};
```

---

## ğŸŒ API ê²Œì´íŠ¸ì›¨ì´ ì„¤ê³„

### Azure API Management êµ¬ì„±

#### 1. ì •ì±… ì„¤ì •
```xml
<!-- API Gateway ì •ì±… -->
<policies>
    <inbound>
        <!-- CORS ì •ì±… -->
        <cors allow-credentials="true">
            <allowed-origins>
                <origin>https://tripgen.com</origin>
                <origin>https://app.tripgen.com</origin>
            </allowed-origins>
            <allowed-methods>
                <method>GET</method>
                <method>POST</method>
                <method>PUT</method>
                <method>DELETE</method>
            </allowed-methods>
        </cors>
        
        <!-- ì¸ì¦ ì •ì±… -->
        <validate-jwt header-name="Authorization" failed-validation-httpcode="401">
            <openid-config url="https://login.microsoftonline.com/{tenant}/v2.0/.well-known/openid_configuration" />
        </validate-jwt>
        
        <!-- ì†ë„ ì œí•œ -->
        <rate-limit calls="1000" renewal-period="60" />
        
        <!-- ë¡œê¹… -->
        <log-to-eventhub logger-id="tripgen-logger">
            <message>@{
                return new JObject(
                    new JProperty("RequestId", context.RequestId),
                    new JProperty("Method", context.Request.Method),
                    new JProperty("Url", context.Request.Url.Path),
                    new JProperty("UserAgent", context.Request.Headers.GetValueOrDefault("User-Agent")),
                    new JProperty("ClientIP", context.Request.IpAddress)
                ).ToString();
            }</message>
        </log-to-eventhub>
    </inbound>
    
    <backend>
        <!-- ì„œí‚· ë¸Œë ˆì´ì»¤ -->
        <retry condition="@(context.Response.StatusCode >= 500)" count="3" interval="2">
            <forward-request />
        </retry>
    </backend>
    
    <outbound>
        <!-- ìºì‹œ í—¤ë” -->
        <cache-store-value key="@("cache-" + context.RequestId)" value="@(context.Response.Body)" duration="300" />
    </outbound>
</policies>
```

#### 2. API ë¼ìš°íŒ… êµ¬ì„±
```yaml
# api-routing-config.yaml
apis:
  - name: profile-api
    path: /api/profile
    backend: https://profile-service.internal.domain.com
    policies:
      - cache: 300s  # 5ë¶„ ìºì‹œ
      - throttle: 100req/min
      
  - name: itinerary-api
    path: /api/itinerary
    backend: https://itinerary-service.internal.domain.com
    policies:
      - cache: 60s   # 1ë¶„ ìºì‹œ
      - throttle: 200req/min
      
  - name: location-api
    path: /api/location
    backend: https://location-service.internal.domain.com
    policies:
      - cache: 600s  # 10ë¶„ ìºì‹œ
      - throttle: 500req/min
      
  - name: mcp-proxy-api
    path: /api/external
    backend: https://tripgen-mcp-proxy.azurewebsites.net
    policies:
      - cache: 1800s # 30ë¶„ ìºì‹œ
      - throttle: 50req/min
```

---

## ğŸ¢ ì»¨í…Œì´ë„ˆ ë° ì„œë²„ë¦¬ìŠ¤ ì „ëµ

### 1. ì»¨í…Œì´ë„ˆ ë°°í¬ ì „ëµ

#### Container Apps Environment ì„¤ì •
```yaml
# container-apps-environment.yaml
location: Korea Central
properties:
  appLogsConfiguration:
    destination: log-analytics
    logAnalyticsConfiguration:
      customerId: {workspace-customer-id}
      sharedKey: {workspace-shared-key}
  
  vnetConfiguration:
    infrastructureSubnetId: /subscriptions/{subscription}/resourceGroups/tripgen-rg/providers/Microsoft.Network/virtualNetworks/tripgen-vnet/subnets/container-subnet
    
  workloadProfiles:
    - name: Consumption
      workloadProfileType: Consumption
    - name: Dedicated-D4
      workloadProfileType: D4
      minimumCount: 1
      maximumCount: 5
```

#### ì´ë¯¸ì§€ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì „ëµ
```bash
# Azure Container Registry ì„¤ì •
az acr create \
  --resource-group tripgen-rg \
  --name tripgenregistry \
  --sku Premium \
  --location "Korea Central"

# ì´ë¯¸ì§€ ë¹Œë“œ ë° í‘¸ì‹œ ìë™í™”
az acr task create \
  --registry tripgenregistry \
  --name build-profile-service \
  --image profile-service:{{.Run.ID}} \
  --context https://github.com/tripgen/profile-service.git \
  --file Dockerfile \
  --commit-trigger-enabled true
```

### 2. ì„œë²„ë¦¬ìŠ¤ ì „ëµ (Azure Functions)

#### MCP Proxy Functions êµ¬ì„±
```json
{
  "version": "2.0",
  "functionApp": {
    "httpWorker": {
      "description": {
        "defaultExecutablePath": "node",
        "defaultWorkerPath": "dist/src/index.js"
      }
    }
  },
  "functions": [
    {
      "name": "kakao-mcp-proxy",
      "entryPoint": "handlers.kakaoProxy",
      "bindings": [
        {
          "authLevel": "function",
          "type": "httpTrigger",
          "direction": "in",
          "name": "req",
          "methods": ["post"]
        },
        {
          "type": "http",
          "direction": "out",
          "name": "res"
        }
      ]
    },
    {
      "name": "google-mcp-proxy",
      "entryPoint": "handlers.googleProxy",
      "bindings": [
        {
          "authLevel": "function",
          "type": "httpTrigger",
          "direction": "in",
          "name": "req",
          "methods": ["post"]
        }
      ]
    }
  ]
}
```

---

## ğŸ—„ï¸ ë°ì´í„° ì €ì¥ì†Œ ì•„í‚¤í…ì²˜

### 1. PostgreSQL êµ¬ì„± (ì„œë¹„ìŠ¤ë³„)

#### Profile Service Database
```yaml
# profile-postgresql.yaml
location: Korea Central
sku:
  name: GP_Gen5_2
  tier: GeneralPurpose
  family: Gen5
  capacity: 2
properties:
  administratorLogin: profileadmin
  version: '13'
  storageProfile:
    storageMB: 32768
    backupRetentionDays: 7
    geoRedundantBackup: Enabled
  
  # ê³ ê°€ìš©ì„± êµ¬ì„±
  availabilityZone: '1'
  standbyAvailabilityZone: '2'
  
  # ë³´ì•ˆ ì„¤ì •
  sslEnforcement: Enabled
  minimalTlsVersion: TLS1_2
  
  # ë„¤íŠ¸ì›Œí¬ ì„¤ì •
  publicNetworkAccess: Disabled
  
  configurations:
    - name: shared_preload_libraries
      value: pg_stat_statements
    - name: log_statement
      value: all
    - name: max_connections
      value: '100'
```

#### Itinerary Service Database (í™•ì¥í˜•)
```yaml
# itinerary-postgresql.yaml
sku:
  name: GP_Gen5_4  # ë” ë†’ì€ ì„±ëŠ¥
  capacity: 4
properties:
  storageProfile:
    storageMB: 65536  # 64GB
    
  # íŒŒí‹°ì…”ë‹ ì§€ì›ì„ ìœ„í•œ ì„¤ì •
  configurations:
    - name: max_worker_processes
      value: '8'
    - name: max_parallel_workers
      value: '4'
    - name: effective_cache_size
      value: '3GB'
    - name: shared_buffers
      value: '1GB'
```

#### Location Service Database (PostGIS)
```sql
-- PostGIS í™•ì¥ ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸
CREATE EXTENSION IF NOT EXISTS postgis;
CREATE EXTENSION IF NOT EXISTS postgis_topology;
CREATE EXTENSION IF NOT EXISTS postgis_tiger_geocoder;

-- ê³µê°„ ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX idx_places_location_gist ON places USING GIST (location);
CREATE INDEX idx_places_region_gist ON places USING GIST (region_boundary);

-- íŒŒí‹°ì…”ë‹ ì„¤ì • (ì§€ì—­ë³„)
CREATE TABLE places_asia PARTITION OF places
FOR VALUES IN ('KR', 'JP', 'CN', 'TH', 'VN');

CREATE TABLE places_europe PARTITION OF places  
FOR VALUES IN ('FR', 'IT', 'ES', 'DE', 'UK');

CREATE TABLE places_americas PARTITION OF places
FOR VALUES IN ('US', 'CA', 'MX', 'BR', 'AR');
```

### 2. ì½ê¸° ì „ìš© ë³µì œë³¸ êµ¬ì„±
```yaml
# read-replica-config.yaml
readReplicas:
  - name: profile-db-read-replica
    location: Korea South  # ë‹¤ë¥¸ ê°€ìš©ì„± ì˜ì—­
    sku:
      name: GP_Gen5_2
      capacity: 2
    
  - name: location-db-read-replica
    location: Japan East  # ê¸€ë¡œë²Œ ë¶„ì‚°
    sku:
      name: GP_Gen5_2  
      capacity: 2
```

---

## ğŸš€ ìºì‹œ ë° ë©”ì‹œì§• ì•„í‚¤í…ì²˜

### 1. Azure Cache for Redis êµ¬ì„±

#### Redis Cluster ì„¤ì •
```yaml
# redis-cluster.yaml
location: Korea Central
sku:
  name: Premium
  family: P
  capacity: 1  # P1 (6GB)

properties:
  # í´ëŸ¬ìŠ¤í„° ëª¨ë“œ í™œì„±í™”
  enableNonSslPort: false
  minimumTlsVersion: '1.2'
  
  # ì§€ì†ì„± ì„¤ì •
  rdbBackupEnabled: true
  rdbBackupFrequency: 60  # 60ë¶„ë§ˆë‹¤
  rdbStorageConnectionString: DefaultEndpointsProtocol=https;AccountName=tripgenbackup;AccountKey=...
  
  # ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ
  subnetId: /subscriptions/{subscription}/resourceGroups/tripgen-rg/providers/Microsoft.Network/virtualNetworks/tripgen-vnet/subnets/redis-subnet
  staticIP: 10.0.2.10
  
  # ë°©í™”ë²½ ê·œì¹™
  redisConfiguration:
    maxmemory-policy: allkeys-lru
    notify-keyspace-events: Ex
    
firewallRules:
  - name: container-apps-subnet
    startIP: 10.0.1.0
    endIP: 10.0.1.255
```

#### ìºì‹œ í‚¤ ë„¤ì´ë° ë° TTL ì „ëµ
```yaml
# cache-strategy.yaml
keyNaming:
  pattern: "{service}:{domain}:{id}:{version}"
  examples:
    - "profile:member:12345:v1"
    - "location:place:67890:v1"
    - "itinerary:trip:11111:v1"

ttlStrategy:
  profile:
    member: 3600        # 1ì‹œê°„
    trip: 1800          # 30ë¶„
    preferences: 7200   # 2ì‹œê°„
    
  location:
    place: 7200         # 2ì‹œê°„
    search: 1800        # 30ë¶„
    translation: 86400  # 24ì‹œê°„
    
  itinerary:
    daily: 3600         # 1ì‹œê°„
    route: 14400        # 4ì‹œê°„
    attachment: 3600    # 1ì‹œê°„

evictionPolicy:
  default: allkeys-lru
  
compressionStrategy:
  enabled: true
  algorithm: gzip
  threshold: 1024  # 1KB ì´ìƒ ì••ì¶•
```

### 2. Azure Service Bus êµ¬ì„±

#### í† í”½ ë° êµ¬ë… ì„¤ê³„
```yaml
# service-bus-config.yaml
serviceBusNamespace:
  name: tripgen-messaging
  location: Korea Central
  sku:
    name: Premium
    capacity: 1

topics:
  - name: profile-events
    maxSizeInMegabytes: 5120
    requiresDuplicateDetection: true
    subscriptions:
      - name: itinerary-service-sub
        maxDeliveryCount: 5
        lockDuration: PT30S
      - name: notification-service-sub
        maxDeliveryCount: 3
        
  - name: itinerary-events
    maxSizeInMegabytes: 5120
    subscriptions:
      - name: profile-service-sub
        maxDeliveryCount: 5
      - name: analytics-service-sub
        maxDeliveryCount: 10

queues:
  - name: ai-itinerary-generation
    maxSizeInMegabytes: 5120
    messageTimeToLive: PT1H
    lockDuration: PT5M
    maxDeliveryCount: 3
    
  - name: external-api-calls
    maxSizeInMegabytes: 1024
    messageTimeToLive: PT10M
    lockDuration: PT1M
    maxDeliveryCount: 5
```

#### ë©”ì‹œì§€ ë¼ìš°íŒ… ê·œì¹™
```csharp
// MessageRouting.cs
public class MessageRoutingRules
{
    public static readonly Dictionary<string, List<string>> EventSubscriptions = new()
    {
        ["ProfileCreated"] = new[] { "itinerary-service", "notification-service" },
        ["ProfileUpdated"] = new[] { "itinerary-service" },
        ["TripCreated"] = new[] { "itinerary-service", "analytics-service" },
        ["ItineraryGenerated"] = new[] { "profile-service", "notification-service" },
        ["LocationFavorited"] = new[] { "analytics-service" }
    };
    
    public static readonly Dictionary<string, QueueConfig> QueueConfigurations = new()
    {
        ["ai-itinerary-generation"] = new QueueConfig
        {
            MaxConcurrency = 5,
            RetryPolicy = ExponentialBackoff(TimeSpan.FromSeconds(30), 3),
            DeadLetterEnabled = true
        }
    };
}
```

---

## ğŸ“Š ìŠ¤ì¼€ì¼ë§ ì •ì±…

### 1. Container Apps ìŠ¤ì¼€ì¼ë§

#### HTTP ê¸°ë°˜ ìŠ¤ì¼€ì¼ë§
```yaml
# scaling-rules.yaml
scaleRules:
  profile-service:
    - name: http-scale-rule
      http:
        metadata:
          concurrentRequests: '10'
        
  itinerary-service:
    - name: http-scale-rule
      http:
        metadata:
          concurrentRequests: '20'
    - name: service-bus-scale-rule
      azureQueue:
        queueName: ai-itinerary-generation
        queueLength: '5'
        
  location-service:
    - name: cpu-scale-rule
      custom:
        type: cpu
        metadata:
          type: Utilization
          value: '70'
    - name: memory-scale-rule
      custom:
        type: memory
        metadata:
          type: Utilization
          value: '80'
```

#### ì˜ˆì¸¡ì  ìŠ¤ì¼€ì¼ë§
```yaml
# predictive-scaling.yaml
autoscaleSettings:
  - name: profile-service-autoscale
    profiles:
      - name: business-hours
        capacity:
          minimum: '2'
          maximum: '10'
          default: '3'
        recurrence:
          timeZone: Korea Standard Time
          days: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday']
          hours: [9]
          minutes: [0]
          
      - name: weekend-traffic
        capacity:
          minimum: '1'
          maximum: '15' 
          default: '2'
        recurrence:
          days: ['Saturday', 'Sunday']
          hours: [10]
          minutes: [0]
          
      - name: night-hours
        capacity:
          minimum: '1'
          maximum: '3'
          default: '1'
        recurrence:
          hours: [22]
          minutes: [0]
```

### 2. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤ì¼€ì¼ë§

#### ìë™ ìŠ¤ì¼€ì¼ì—… ì •ì±…
```yaml
# database-scaling.yaml
autoscaleConfigurations:
  profileDatabase:
    enableAutomaticTuning: true
    performanceTier: 
      min: GP_Gen5_2
      max: GP_Gen5_8
    storageAutogrow: true
    
    scaleRules:
      - metric: cpu_percent
        threshold: 80
        action: scale_up
        cooldown: 300
        
      - metric: memory_percent  
        threshold: 85
        action: scale_up
        cooldown: 300
        
  itineraryDatabase:
    enableAutomaticTuning: true
    performanceTier:
      min: GP_Gen5_4  
      max: GP_Gen5_16
    
    readReplicaScaling:
      enabled: true
      minReplicas: 1
      maxReplicas: 3
      scaleUpThreshold: 70  # CPU %
```

---

## âš¡ ì„±ëŠ¥ ìµœì í™” ë°©ì•ˆ

### 1. Connection Pooling ì „ëµ

#### PostgreSQL ì—°ê²° í’€ë§
```yaml
# connection-pooling.yaml
services:
  profile-service:
    datasource:
      hikari:
        pool-name: ProfileServicePool
        maximum-pool-size: 20
        minimum-idle: 5
        connection-timeout: 20000
        idle-timeout: 300000
        max-lifetime: 1200000
        validation-timeout: 5000
        leak-detection-threshold: 60000
        
  itinerary-service:
    datasource:
      hikari:
        pool-name: ItineraryServicePool
        maximum-pool-size: 30  # ë” ë†’ì€ ì²˜ë¦¬ëŸ‰
        minimum-idle: 10
        
  location-service:
    datasource:
      hikari:
        pool-name: LocationServicePool
        maximum-pool-size: 25
        minimum-idle: 8
```

#### Redis ì—°ê²° í’€ë§  
```yaml
# redis-connection-pool.yaml
redis:
  jedis:
    pool:
      max-active: 50
      max-idle: 20
      min-idle: 5
      max-wait: 3000ms
      test-on-borrow: true
      test-while-idle: true
  
  cluster:
    nodes:
      - tripgen-cache.redis.cache.windows.net:6380
    max-redirects: 3
    
  timeout: 2000ms
  ssl: true
```

### 2. ìºì‹œ ìµœì í™”

#### ë‹¤ê³„ì¸µ ìºì‹œ ì „ëµ
```mermaid
graph TB
    A[Client Request] --> B[API Gateway Cache]
    B --> |Cache Miss| C[Service Cache Layer]
    C --> |Cache Miss| D[Redis Cluster]  
    D --> |Cache Miss| E[Database]
    
    B --> |Cache Hit| F[Response]
    C --> |Cache Hit| F
    D --> |Cache Hit| F
    E --> |Write Through| D
    E --> |Response| F
```

#### ìºì‹œ ìµœì í™” ì„¤ì •
```java
// CacheConfiguration.java
@Configuration
@EnableCaching
public class CacheConfiguration {
    
    @Bean
    @Primary
    public RedisCacheManager cacheManager(LettuceConnectionFactory connectionFactory) {
        RedisCacheConfiguration config = RedisCacheConfiguration.defaultCacheConfig()
            .entryTtl(Duration.ofMinutes(30))
            .serializeKeysWith(RedisSerializationContext.SerializationPair
                .fromSerializer(new StringRedisSerializer()))
            .serializeValuesWith(RedisSerializationContext.SerializationPair
                .fromSerializer(new GenericJackson2JsonRedisSerializer()))
            .disableCachingNullValues()
            .computePrefixWith(cacheName -> "tripgen:" + cacheName + ":");
            
        Map<String, RedisCacheConfiguration> cacheConfigurations = Map.of(
            "profiles", config.entryTtl(Duration.ofHours(1)),
            "trips", config.entryTtl(Duration.ofMinutes(30)), 
            "places", config.entryTtl(Duration.ofHours(2)),
            "searches", config.entryTtl(Duration.ofMinutes(15)),
            "translations", config.entryTtl(Duration.ofHours(24))
        );
        
        return RedisCacheManager.builder(connectionFactory)
            .cacheDefaults(config)
            .withInitialCacheConfigurations(cacheConfigurations)
            .transactionAware()
            .build();
    }
}
```

### 3. ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”

#### ì¸ë±ìŠ¤ ì „ëµ
```sql
-- í”„ë¡œíŒŒì¼ ì„œë¹„ìŠ¤ ì¸ë±ìŠ¤
CREATE INDEX CONCURRENTLY idx_trips_date_range ON trips USING btree (start_date, end_date);
CREATE INDEX CONCURRENTLY idx_trip_members_lookup ON trip_members USING btree (trip_id, member_id);
CREATE INDEX CONCURRENTLY idx_members_preferences ON member_preferences USING gin (preference_type);

-- ì¼ì • ì„œë¹„ìŠ¤ ì¸ë±ìŠ¤  
CREATE INDEX CONCURRENTLY idx_itineraries_trip_date ON itineraries USING btree (trip_id, date);
CREATE INDEX CONCURRENTLY idx_daily_activities_time ON daily_activities USING btree (itinerary_id, start_time);
CREATE INDEX CONCURRENTLY idx_place_cache_lookup ON place_cache USING hash (place_id);

-- ì¥ì†Œ ì„œë¹„ìŠ¤ ê³µê°„ ì¸ë±ìŠ¤
CREATE INDEX CONCURRENTLY idx_places_location_gist ON places USING gist (location);
CREATE INDEX CONCURRENTLY idx_places_category_region ON places USING btree (category, region_code);
CREATE INDEX CONCURRENTLY idx_reviews_place_rating ON reviews USING btree (place_id, rating DESC);
```

#### ì¿¼ë¦¬ ìµœì í™”
```sql
-- íŒŒí‹°ì…”ë‹ ì „ëµ
CREATE TABLE itineraries_2024 PARTITION OF itineraries
FOR VALUES FROM ('2024-01-01') TO ('2025-01-01');

CREATE TABLE itineraries_2025 PARTITION OF itineraries  
FOR VALUES FROM ('2025-01-01') TO ('2026-01-01');

-- ë¨¸í„°ë¦¬ì–¼ë¼ì´ì¦ˆë“œ ë·°
CREATE MATERIALIZED VIEW popular_places AS
SELECT 
    place_id,
    AVG(rating) as avg_rating,
    COUNT(*) as review_count,
    region_code
FROM reviews r 
JOIN places p ON r.place_id = p.id
WHERE r.created_at >= CURRENT_DATE - INTERVAL '30 days'
GROUP BY place_id, region_code
HAVING COUNT(*) >= 10
ORDER BY avg_rating DESC, review_count DESC;

CREATE UNIQUE INDEX ON popular_places (place_id);
```

---

## ğŸ“Š ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…

### 1. Azure Monitor í†µí•©

#### Application Insights êµ¬ì„±
```yaml
# monitoring-config.yaml
applicationInsights:
  instrumentationKey: ${AI_INSTRUMENTATION_KEY}
  connectionString: InstrumentationKey=${AI_INSTRUMENTATION_KEY};IngestionEndpoint=https://koreacentral-1.in.applicationinsights.azure.com/
  
  sampling:
    percentage: 100
    excludedTypes: Request;Dependency;Exception
    
  customMetrics:
    - name: cache_hit_ratio
      dimensions: [service, cache_type]
    - name: external_api_latency  
      dimensions: [provider, endpoint]
    - name: database_query_duration
      dimensions: [service, query_type]
      
  alerts:
    - name: high-error-rate
      metric: exceptions/count
      threshold: 10
      timeWindow: PT5M
      severity: 2
      
    - name: slow-response-time
      metric: requests/duration
      threshold: 5000
      timeWindow: PT5M
      severity: 3
```

#### ë¡œê·¸ ì¿¼ë¦¬ ë° ëŒ€ì‹œë³´ë“œ
```kql
# kusto-queries.kql

# ì„œë¹„ìŠ¤ë³„ ì„±ëŠ¥ ë¶„ì„
requests
| where timestamp > ago(1h)
| where cloud_RoleName in ("profile-service", "itinerary-service", "location-service")
| summarize 
    RequestCount = count(),
    AvgDuration = avg(duration),
    P95Duration = percentile(duration, 95),
    SuccessRate = avg(toint(success)) * 100
  by cloud_RoleName, bin(timestamp, 5m)
| render timechart

# ìºì‹œ íˆíŠ¸ìœ¨ ë¶„ì„
customMetrics
| where name == "cache_hit_ratio"
| extend service = tostring(customDimensions.service)
| extend cache_type = tostring(customDimensions.cache_type)
| summarize AvgHitRatio = avg(value) by service, cache_type, bin(timestamp, 10m)
| render timechart

# ì™¸ë¶€ API í˜¸ì¶œ ë¶„ì„
dependencies
| where type == "HTTP"
| where target contains "kakao" or target contains "google"
| summarize 
    CallCount = count(),
    AvgDuration = avg(duration),
    FailureRate = avg(toint(success == false)) * 100
  by target, bin(timestamp, 15m)
| render timechart
```

### 2. í†µí•© ëŒ€ì‹œë³´ë“œ

#### Grafana ëŒ€ì‹œë³´ë“œ êµ¬ì„±
```json
{
  "dashboard": {
    "title": "TripGen Service Dashboard",
    "panels": [
      {
        "title": "Service Health Overview",
        "type": "stat",
        "targets": [
          {
            "datasource": "ApplicationInsights",
            "query": "requests | summarize SuccessRate = avg(toint(success)) * 100"
          }
        ]
      },
      {
        "title": "Request Rate by Service",
        "type": "graph", 
        "targets": [
          {
            "query": "requests | summarize RequestRate = count() by cloud_RoleName, bin(timestamp, 1m)"
          }
        ]
      },
      {
        "title": "Database Performance",
        "type": "graph",
        "targets": [
          {
            "query": "customMetrics | where name == 'database_query_duration' | summarize AvgDuration = avg(value) by customDimensions.service"
          }
        ]
      },
      {
        "title": "Cache Hit Ratio",
        "type": "singlestat",
        "targets": [
          {
            "query": "customMetrics | where name == 'cache_hit_ratio' | summarize AvgHitRatio = avg(value)"
          }
        ]
      }
    ]
  }
}
```

---

## ğŸ’° ë¹„ìš© ìµœì í™”

### 1. ë¦¬ì†ŒìŠ¤ ìµœì í™”

#### ìŠ¤ë§ˆíŠ¸ ìŠ¤ì¼€ì¼ë§
```yaml
# cost-optimization.yaml
costOptimization:
  autoShutdown:
    enabled: true
    schedule:
      - environment: development
        shutdown: "22:00"
        startup: "08:00"
        timezone: "Korea Standard Time"
        
  reservedInstances:
    - resource: "Azure Database for PostgreSQL"
      term: "1ë…„"
      paymentOption: "ì›”ê°„"
      estimatedSavings: "30%"
      
  spotInstances:
    - resource: "Container Apps Jobs" 
      workloadType: "ë°°ì¹˜ ì²˜ë¦¬"
      maxPrice: "$0.05/hour"
      
taggingStrategy:
  mandatory:
    - key: "Environment"
      values: ["dev", "staging", "prod"]
    - key: "Service"  
      values: ["profile", "itinerary", "location"]
    - key: "Owner"
      values: ["team-backend", "team-frontend"]
    - key: "CostCenter"
      values: ["development", "operations"]
```

#### ì‚¬ìš©ëŸ‰ ê¸°ë°˜ ìš”ê¸ˆì œ í™œìš©
```yaml
# usage-based-pricing.yaml
services:
  functions:
    plan: "Consumption"
    estimatedInvocations: 500000  # ì›”ê°„
    estimatedCost: "$20"
    
  apiManagement:
    tier: "Developer"  # ê°œë°œìš©, ìš´ì˜ì‹œ Standardë¡œ ì—…ê·¸ë ˆì´ë“œ
    estimatedCalls: 1000000  # ì›”ê°„
    estimatedCost: "$50"
    
  containerApps:
    pricing:
      cpu: "$0.000024/vCPU-second"
      memory: "$0.000002.5/GiB-second" 
    estimatedMonthlyCost:
      profile: "$30"
      itinerary: "$60"
      location: "$40"
```

### 2. ìŠ¤í† ë¦¬ì§€ ê³„ì¸µí™”

#### Blob Storage ìˆ˜ëª…ì£¼ê¸°
```json
{
  "rules": [
    {
      "name": "attachment-lifecycle",
      "type": "Lifecycle",
      "definition": {
        "actions": {
          "baseBlob": {
            "tierToCool": {
              "daysAfterModificationGreaterThan": 30
            },
            "tierToArchive": {
              "daysAfterModificationGreaterThan": 90
            },
            "delete": {
              "daysAfterModificationGreaterThan": 2555
            }
          }
        },
        "filters": {
          "blobTypes": ["blockBlob"],
          "prefixMatch": ["attachments/"]
        }
      }
    }
  ]
}
```

---

## ğŸ”’ ë³´ì•ˆ ë° ë„¤íŠ¸ì›Œí‚¹

### 1. ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ

#### Virtual Network êµ¬ì„±
```yaml
# network-security.yaml
virtualNetwork:
  name: tripgen-vnet
  addressPrefix: "10.0.0.0/16"
  
  subnets:
    - name: container-subnet
      addressPrefix: "10.0.1.0/24"
      serviceEndpoints:
        - Microsoft.Sql
        - Microsoft.Storage
        - Microsoft.KeyVault
        
    - name: database-subnet
      addressPrefix: "10.0.2.0/24"
      delegations:
        - Microsoft.DBforPostgreSQL/flexibleServers
        
    - name: redis-subnet
      addressPrefix: "10.0.3.0/24"
      
    - name: functions-subnet
      addressPrefix: "10.0.4.0/24"

networkSecurityGroups:
  - name: container-nsg
    securityRules:
      - name: allow-https-inbound
        protocol: Tcp
        sourcePortRange: "*"
        destinationPortRange: "443"
        sourceAddressPrefix: "*"
        destinationAddressPrefix: "VirtualNetwork"
        access: Allow
        priority: 100
        direction: Inbound
        
  - name: database-nsg  
    securityRules:
      - name: allow-postgresql
        protocol: Tcp
        sourceAddressPrefix: "10.0.1.0/24"  # Container subnet only
        destinationPortRange: "5432"
        access: Allow
        priority: 100
```

#### Private Link êµ¬ì„±
```yaml
# private-link.yaml
privateEndpoints:
  - name: profile-db-pe
    service: Azure Database for PostgreSQL
    subnetId: database-subnet
    privateDnsZone: privatelink.postgres.database.azure.com
    
  - name: redis-cache-pe
    service: Azure Cache for Redis
    subnetId: redis-subnet
    privateDnsZone: privatelink.redis.cache.windows.net
    
  - name: storage-pe
    service: Azure Blob Storage
    subnetId: container-subnet
    privateDnsZone: privatelink.blob.core.windows.net
```

### 2. ì¸ì¦ ë° ê¶Œí•œ ê´€ë¦¬

#### Managed Identity êµ¬ì„±
```yaml
# managed-identity.yaml
managedIdentities:
  - name: profile-service-identity
    type: SystemAssigned
    roleAssignments:
      - scope: /subscriptions/{subscription}/resourceGroups/tripgen-rg/providers/Microsoft.DBforPostgreSQL/flexibleServers/profile-db
        roleDefinitionId: PostgreSQL Contributor
      - scope: /subscriptions/{subscription}/resourceGroups/tripgen-rg/providers/Microsoft.Cache/Redis/tripgen-cache
        roleDefinitionId: Redis Cache Contributor
        
  - name: itinerary-service-identity
    type: SystemAssigned
    roleAssignments:
      - scope: /subscriptions/{subscription}/resourceGroups/tripgen-rg/providers/Microsoft.ServiceBus/namespaces/tripgen-messaging
        roleDefinitionId: Azure Service Bus Data Owner
      - scope: /subscriptions/{subscription}/resourceGroups/tripgen-rg/providers/Microsoft.Storage/storageAccounts/tripgenattachments
        roleDefinitionId: Storage Blob Data Contributor
```

#### Key Vault í†µí•©
```yaml
# keyvault-config.yaml
keyVault:
  name: tripgen-keyvault
  location: Korea Central
  
  secrets:
    - name: kakao-api-key
      value: ${KAKAO_API_KEY}
      contentType: "API Key"
      
    - name: google-maps-api-key
      value: ${GOOGLE_API_KEY}
      contentType: "API Key"
      
    - name: profile-db-connection-string
      value: "postgresql://profileadmin@profile-db.postgres.database.azure.com:5432/profiledb?sslmode=require"
      
  certificates:
    - name: tripgen-ssl-cert
      issuer: DigiCert
      dnsNames: ["api.tripgen.com", "*.api.tripgen.com"]
      
  accessPolicies:
    - objectId: ${PROFILE_SERVICE_PRINCIPAL_ID}
      permissions:
        secrets: ["get", "list"]
    - objectId: ${FUNCTIONS_PRINCIPAL_ID}  
      permissions:
        secrets: ["get"]
        certificates: ["get"]
```

---

## ğŸ“ˆ SLA ë° ê°€ìš©ì„±

### 1. ì„œë¹„ìŠ¤ë³„ SLA ì •ì˜

| ì„œë¹„ìŠ¤ | ëª©í‘œ ê°€ìš©ì„± | RTO | RPO | ëª¨ë‹ˆí„°ë§ ì§€í‘œ |
|--------|-------------|-----|-----|---------------|
| API Gateway | 99.95% | 15ë¶„ | 5ë¶„ | ì‘ë‹µì‹œê°„ < 500ms |
| Profile Service | 99.9% | 30ë¶„ | 15ë¶„ | ì‘ë‹µì‹œê°„ < 200ms |
| Itinerary Service | 99.9% | 30ë¶„ | 15ë¶„ | ì‘ë‹µì‹œê°„ < 1000ms |
| Location Service | 99.5% | 1ì‹œê°„ | 30ë¶„ | ì‘ë‹µì‹œê°„ < 300ms |
| PostgreSQL | 99.99% | 1ì‹œê°„ | 5ë¶„ | ì—°ê²° ì„±ê³µë¥  > 99% |
| Redis Cache | 99.9% | 15ë¶„ | ì¦‰ì‹œ | ìºì‹œ íˆíŠ¸ìœ¨ > 80% |

### 2. ì¥ì•  ë³µêµ¬ ì „ëµ

#### ìë™ ë³µêµ¬ ë©”ì»¤ë‹ˆì¦˜
```yaml
# disaster-recovery.yaml
backupStrategy:
  databases:
    automated:
      - service: PostgreSQL
        frequency: daily
        retention: 35ì¼
        crossRegionReplication: true
        
  storage:
    - service: Blob Storage
      replication: GRS  # Geo-Redundant Storage
      retention: 90ì¼
      
failoverStrategy:
  primary: Korea Central
  secondary: Korea South
  
  automaticFailover:
    enabled: true
    conditions:
      - metric: availability
        threshold: "< 99%"
        duration: "5ë¶„"
      - metric: error_rate  
        threshold: "> 5%"
        duration: "3ë¶„"
        
healthChecks:
  - name: profile-service-health
    endpoint: /api/profile/health
    interval: 30s
    timeout: 5s
    
  - name: database-connectivity
    type: custom
    script: |
      pg_isready -h profile-db.postgres.database.azure.com -p 5432
    interval: 60s
```

---

## ğŸš€ ë°°í¬ íŒŒì´í”„ë¼ì¸

### 1. CI/CD êµ¬ì„±

#### GitHub Actions ì›Œí¬í”Œë¡œìš°
```yaml
# .github/workflows/deploy.yml
name: Deploy TripGen Services
on:
  push:
    branches: [main]
    paths: 
      - 'services/**'
      - 'infrastructure/**'

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        service: [profile-service, itinerary-service, location-service]
        
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Java
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          
      - name: Build service
        run: |
          cd services/${{ matrix.service }}
          ./gradlew build -x test
          
      - name: Build Docker image
        run: |
          docker build -t tripgenregistry.azurecr.io/${{ matrix.service }}:${{ github.sha }} \
            services/${{ matrix.service }}
            
      - name: Push to ACR
        run: |
          az acr login --name tripgenregistry
          docker push tripgenregistry.azurecr.io/${{ matrix.service }}:${{ github.sha }}
          
      - name: Deploy to Container Apps
        run: |
          az containerapp update \
            --name ${{ matrix.service }} \
            --resource-group tripgen-rg \
            --image tripgenregistry.azurecr.io/${{ matrix.service }}:${{ github.sha }}
```

#### Blue-Green ë°°í¬
```yaml
# blue-green-deployment.yaml
deployment:
  strategy: blue-green
  
  blueEnvironment:
    name: tripgen-env-blue
    services:
      - name: profile-service-blue
        replicas: 3
        
  greenEnvironment:  
    name: tripgen-env-green
    services:
      - name: profile-service-green
        replicas: 3
        
  trafficSwitching:
    canaryRatio: 10  # 10% íŠ¸ë˜í”½ìœ¼ë¡œ ì‹œì‘
    increments: [25, 50, 75, 100]  # ë‹¨ê³„ì  ì¦ê°€
    validationSteps:
      - healthCheck: true
        errorRateThreshold: 1%
        latencyThreshold: 500ms
        duration: 5ë¶„
```

### 2. ì¸í”„ë¼ as Code

#### Bicep í…œí”Œë¦¿
```bicep
// main.bicep
param location string = 'Korea Central'
param environmentName string = 'tripgen-env'

module containerAppsEnvironment 'modules/container-apps-env.bicep' = {
  name: 'container-apps-environment'
  params: {
    location: location
    environmentName: environmentName
  }
}

module profileService 'modules/profile-service.bicep' = {
  name: 'profile-service'
  params: {
    location: location
    environmentId: containerAppsEnvironment.outputs.environmentId
    databaseConnectionString: profileDatabase.outputs.connectionString
  }
  dependsOn: [
    containerAppsEnvironment
  ]
}

module profileDatabase 'modules/postgresql.bicep' = {
  name: 'profile-database'
  params: {
    location: location
    serverName: 'tripgen-profile-db'
    databaseName: 'profiledb'
    administratorLogin: 'profileadmin'
    administratorPassword: keyVault.getSecret('profile-db-password')
  }
}
```

---

## ğŸ“‹ êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸

### Phase 1: ê¸°ë³¸ ì¸í”„ë¼ (2ì£¼)
- [ ] Azure Resource Group ë° ë„¤íŠ¸ì›Œí‚¹ ì„¤ì •
- [ ] Container Apps Environment êµ¬ì„±
- [ ] PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ 3ê°œ í”„ë¡œë¹„ì €ë‹
- [ ] Redis Cache í´ëŸ¬ìŠ¤í„° ì„¤ì •
- [ ] API Management ê¸°ë³¸ êµ¬ì„±

### Phase 2: ì„œë¹„ìŠ¤ ë°°í¬ (3ì£¼)
- [ ] Profile Service ì»¨í…Œì´ë„ˆ ë°°í¬
- [ ] Itinerary Service ì»¨í…Œì´ë„ˆ ë°°í¬  
- [ ] Location Service ì»¨í…Œì´ë„ˆ ë°°í¬
- [ ] MCP Proxy Functions ë°°í¬
- [ ] Service Bus í† í”½/í êµ¬ì„±

### Phase 3: í†µí•© ë° ìµœì í™” (2ì£¼)
- [ ] ì„œë¹„ìŠ¤ ê°„ í†µì‹  í…ŒìŠ¤íŠ¸
- [ ] ìºì‹œ ì „ëµ ì ìš© ë° ê²€ì¦
- [ ] ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ë° íŠœë‹
- [ ] ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ êµ¬ì„±
- [ ] ë³´ì•ˆ ì •ì±… ì ìš©

### Phase 4: ìš´ì˜ ì¤€ë¹„ (1ì£¼)
- [ ] ìë™ ë°±ì—… ë° ë³µêµ¬ í…ŒìŠ¤íŠ¸
- [ ] ì¥ì•  ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸
- [ ] ë¬¸ì„œí™” ì™„ë£Œ
- [ ] íŒ€ êµìœ¡ ë° ì¸ìˆ˜ì¸ê³„

---

## ğŸ“Š ì˜ˆìƒ ë¹„ìš© ë¶„ì„

### ì›”ê°„ ìš´ì˜ ë¹„ìš© (USD, ê¸°ì¤€: í•œêµ­ ì¤‘ë¶€)

| ì„œë¹„ìŠ¤ | SKU/ê³„ì¸µ | ì˜ˆìƒ ë¹„ìš© | ë¹„ê³  |
|--------|----------|-----------|------|
| **Compute** | | | |
| Container Apps (Profile) | 0.25 vCPU, 0.5Gi | $25 | í‰ê·  2-3 ì¸ìŠ¤í„´ìŠ¤ |
| Container Apps (Itinerary) | 0.5 vCPU, 1Gi | $60 | í‰ê·  3-5 ì¸ìŠ¤í„´ìŠ¤ |
| Container Apps (Location) | 0.25 vCPU, 0.5Gi | $30 | í‰ê·  2-4 ì¸ìŠ¤í„´ìŠ¤ |
| Azure Functions (MCP) | Premium EP1 | $35 | ì™¸ë¶€ API í”„ë¡ì‹œ |
| **Database** | | | |
| PostgreSQL (Profile) | GP 2 vCore, 32GB | $85 | ì½ê¸° ë³µì œë³¸ í¬í•¨ |
| PostgreSQL (Itinerary) | GP 4 vCore, 64GB | $170 | ì½ê¸° ë³µì œë³¸ í¬í•¨ |
| PostgreSQL (Location) | GP 2 vCore, 32GB | $85 | PostGIS í¬í•¨ |
| **Cache & Messaging** | | | |
| Azure Cache for Redis | Premium P1 (6GB) | $250 | í´ëŸ¬ìŠ¤í„° êµ¬ì„± |
| Service Bus | Premium | $75 | ë©”ì‹œì§• ì²˜ë¦¬ |
| **Storage** | | | |
| Blob Storage | Standard | $15 | ì²¨ë¶€íŒŒì¼ ì €ì¥ |
| **Networking** | | | |
| API Management | Developer | $50 | API Gateway |
| Front Door | Standard | $35 | ê¸€ë¡œë²Œ ë¡œë“œë°¸ëŸ°ì„œ |
| **Monitoring** | | | |
| Application Insights | Pay-as-you-go | $25 | ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹… |
| **Total** | | **$940** | **ì›”ê°„ ì˜ˆìƒ ë¹„ìš©** |

### ë¹„ìš© ìµœì í™” ë°©ì•ˆ
1. **ì˜ˆì•½ ì¸ìŠ¤í„´ìŠ¤**: ë°ì´í„°ë² ì´ìŠ¤ 1ë…„ ì˜ˆì•½ìœ¼ë¡œ 30% ì ˆì•½ â†’ **$102 ì ˆì•½**
2. **ê°œë°œí™˜ê²½ ìë™ ì¢…ë£Œ**: ì—…ë¬´ì™¸ ì‹œê°„ ì¢…ë£Œë¡œ 40% ì ˆì•½ â†’ **$60 ì ˆì•½**  
3. **Spot ì¸ìŠ¤í„´ìŠ¤**: ë°°ì¹˜ ì‘ì—…ì— í™œìš©ìœ¼ë¡œ 50% ì ˆì•½ â†’ **$20 ì ˆì•½**

**ìµœì í™” í›„ ì›”ê°„ ë¹„ìš©: ~$758**

---

## âœ… ê²°ë¡ 

ë³¸ Azure Cloud ê¸°ë°˜ ì¸í”„ë¼ ì•„í‚¤í…ì²˜ëŠ” ë‹¤ìŒê³¼ ê°™ì€ íŠ¹ì§•ì„ ì œê³µí•©ë‹ˆë‹¤:

### ğŸ¯ ì£¼ìš” ë‹¬ì„± ëª©í‘œ
1. **ê³ ê°€ìš©ì„±**: 99.9% ì´ìƒ ì„œë¹„ìŠ¤ ê°€ìš©ì„± ë³´ì¥
2. **í™•ì¥ì„±**: íŠ¸ë˜í”½ ì¦ê°€ì— ë”°ë¥¸ ìë™ ìŠ¤ì¼€ì¼ë§
3. **ì„±ëŠ¥**: ì‘ë‹µì‹œê°„ < 500ms (í‰ê· )
4. **ë¹„ìš© íš¨ìœ¨ì„±**: ì‚¬ìš©ëŸ‰ ê¸°ë°˜ ìµœì í™”ë¡œ ì›” $758
5. **ë³´ì•ˆ**: ë„¤íŠ¸ì›Œí¬ ê²©ë¦¬ ë° ê´€ë¦¬í˜• ì¸ì¦
6. **ìš´ì˜ íš¨ìœ¨ì„±**: ì™„ì „ ê´€ë¦¬í˜• ì„œë¹„ìŠ¤ í™œìš©

### ğŸš€ ì°¨ë³„í™” í¬ì¸íŠ¸
- **ì»¨í…Œì´ë„ˆ + ì„œë²„ë¦¬ìŠ¤ í•˜ì´ë¸Œë¦¬ë“œ**: ì›Œí¬ë¡œë“œë³„ ìµœì  ì»´í“¨íŒ… ì„ íƒ
- **ì§€ëŠ¥í˜• ìºì‹±**: ë‹¤ê³„ì¸µ ìºì‹œë¡œ ì™¸ë¶€ API ì˜ì¡´ì„± ìµœì†Œí™”
- **ìë™í™”ëœ ìš´ì˜**: Infrastructure as Codeì™€ CI/CD í†µí•©
- **ì˜ˆì¸¡ì  ìŠ¤ì¼€ì¼ë§**: ì‚¬ìš© íŒ¨í„´ ê¸°ë°˜ ì‚¬ì „ ìŠ¤ì¼€ì¼ë§
- **ê¸€ë¡œë²Œ ë°°í¬ ì¤€ë¹„**: ë‹¤ì¤‘ ë¦¬ì „ í™•ì¥ ê°€ëŠ¥í•œ ì„¤ê³„

### ğŸ”§ êµ¬í˜„ ì¤€ë¹„ ì‚¬í•­
1. **ê¸°ìˆ  ìŠ¤íƒ í™•ì •**: Spring Boot 3.2, PostgreSQL 13, Redis 7
2. **íŒ€ ì—­ëŸ‰ ì¤€ë¹„**: Azure Container Apps, Bicep IaC ê¸°ìˆ  ìŠµë“
3. **ìš´ì˜ ì²´ê³„**: ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ, ì¥ì•  ëŒ€ì‘ í”„ë¡œì„¸ìŠ¤ êµ¬ì¶•
4. **ë³´ì•ˆ ì¸ì¦**: Azure ë³´ì•ˆ ì •ì±… ë° ì»´í”Œë¼ì´ì–¸ìŠ¤ ê²€í† 

ì´ ì„¤ê³„ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì•ˆì •ì ì´ê³  í™•ì¥ ê°€ëŠ¥í•œ ì—¬í–‰ ì¼ì • ìƒì„± ì„œë¹„ìŠ¤ë¥¼ Azure í´ë¼ìš°ë“œì— ì„±ê³µì ìœ¼ë¡œ êµ¬ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.