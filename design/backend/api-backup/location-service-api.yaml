openapi: 3.0.0
info:
  title: Location Service API
  description: TripGen 장소 검색 및 정보 제공 서비스
  version: 1.0.0
  contact:
    name: 정백엔드
    email: backend@tripgen.com

servers:
  - url: http://localhost:8004/api/v1/location
    description: Local server
  - url: https://api.tripgen.com/api/v1/location
    description: Production server
  - url: https://virtserver.swaggerhub.com/tripgen/location-service/1.0.0
    description: SwaggerHub Mock API

paths:
  /search/nearby:
    get:
      x-user-story: UFR-LOC-010
      x-controller: SearchController
      tags:
        - Search
      summary: 주변 장소 검색
      description: 출발지 기준 이동시간 내 장소 검색
      parameters:
        - name: origin
          in: query
          required: true
          schema:
            type: string
          description: "출발지 (주소 또는 좌표)"
          example: "Munich Central Station"
        - name: transportation
          in: query
          required: true
          schema:
            type: string
            enum: [public, car, walk]
          description: 이동수단
          example: "public"
        - name: timeRange
          in: query
          required: true
          schema:
            type: integer
            enum: [10, 30, 60]
          description: "시간 범위 (분)"
          example: 30
        - name: category
          in: query
          schema:
            type: string
            enum: [all, attraction, restaurant, laundry]
            default: all
          description: 카테고리 필터
        - name: keyword
          in: query
          schema:
            type: string
          description: 검색 키워드
          example: "박물관"
        - name: sort
          in: query
          schema:
            type: string
            enum: [time, rating, name, reviews]
            default: time
          description: 정렬 옵션
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
          description: 페이지 번호
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 10
            maximum: 50
            default: 20
          description: 페이지당 결과 수
      responses:
        '200':
          description: 검색 결과
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchResponse'
        '400':
          description: 잘못된 요청
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /places/{placeId}:
    get:
      x-user-story: UFR-LOC-030
      x-controller: PlaceController
      tags:
        - Places
      summary: 장소 상세정보 조회
      description: 특정 장소의 상세 정보 조회
      parameters:
        - name: placeId
          in: path
          required: true
          schema:
            type: string
          description: 장소 ID
        - name: includeReviews
          in: query
          schema:
            type: boolean
            default: true
          description: 리뷰 포함 여부
        - name: includeAI
          in: query
          schema:
            type: boolean
            default: true
          description: AI 추천 정보 포함 여부
      responses:
        '200':
          description: 장소 상세 정보
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlaceDetailResponse'
        '404':
          description: 장소를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /places/{placeId}/business-hours:
    get:
      x-user-story: UFR-LOC-030
      x-controller: PlaceController
      tags:
        - Places
      summary: 영업시간 조회
      description: 장소의 실시간 영업시간 정보 조회
      parameters:
        - name: placeId
          in: path
          required: true
          description: 장소 ID
          schema:
            type: string
        - name: date
          in: query
          description: "특정 날짜의 영업시간 (기본값: 오늘)"
          schema:
            type: string
            format: date
      responses:
        '200':
          description: 영업시간 정보
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BusinessHoursResponse'
        '404':
          description: 장소를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /places/batch:
    post:
      x-user-story: UFR-LOC-020
      x-controller: PlaceController
      tags:
        - Places
      summary: 다중 장소 정보 조회
      description: 여러 장소의 정보를 한 번에 조회
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BatchPlaceRequest'
      responses:
        '200':
          description: 장소 정보 목록
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchPlaceResponse'
        '400':
          description: 잘못된 요청
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /geocode:
    get:
      x-user-story: UFR-LOC-010
      x-controller: GeocodingController
      tags:
        - Geocoding
      summary: 주소를 좌표로 변환
      description: 주소 문자열을 위도/경도 좌표로 변환
      parameters:
        - name: address
          in: query
          required: true
          schema:
            type: string
          description: 변환할 주소
          example: "Munich Central Station"
      responses:
        '200':
          description: 지오코딩 결과
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GeocodeResponse'
        '404':
          description: 주소를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /reverse-geocode:
    get:
      x-user-story: UFR-LOC-010
      x-controller: GeocodingController
      tags:
        - Geocoding
      summary: 좌표를 주소로 변환
      description: 위도/경도 좌표를 주소로 변환
      parameters:
        - name: lat
          in: query
          required: true
          schema:
            type: number
          description: 위도
          example: 48.1351
        - name: lng
          in: query
          required: true
          schema:
            type: number
          description: 경도
          example: 11.5820
      responses:
        '200':
          description: 역지오코딩 결과
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReverseGeocodeResponse'
        '404':
          description: 좌표에 해당하는 주소를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /directions:
    get:
      x-user-story: UFR-LOC-020
      x-controller: DirectionsController
      tags:
        - Directions
      summary: 경로 안내
      description: 두 지점 간 경로 정보 제공
      parameters:
        - name: origin
          in: query
          required: true
          schema:
            type: string
          description: "출발지 (주소 또는 좌표)"
        - name: destination
          in: query
          required: true
          schema:
            type: string
          description: "목적지 (주소 또는 좌표)"
        - name: mode
          in: query
          required: true
          schema:
            type: string
            enum: [walking, driving, transit]
          description: 이동 방식
        - name: alternatives
          in: query
          schema:
            type: boolean
            default: false
          description: 대체 경로 포함 여부
      responses:
        '200':
          description: 경로 정보
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DirectionsResponse'
        '400':
          description: 잘못된 요청
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    SearchResponse:
      type: object
      properties:
        query:
          type: object
          properties:
            origin:
              type: string
            transportation:
              type: string
            timeRange:
              type: integer
            category:
              type: string
        totalResults:
          type: integer
          description: 전체 검색 결과 수
        places:
          type: array
          items:
            $ref: '#/components/schemas/PlaceCard'
        pagination:
          type: object
          properties:
            page:
              type: integer
            limit:
              type: integer
            totalPages:
              type: integer
            hasMore:
              type: boolean

    PlaceCard:
      type: object
      properties:
        placeId:
          type: string
          example: "ChIJRyYlNBl2nkcRzpKG9xq6BAQ"
        placeName:
          type: string
          example: "마리엔플라츠"
        category:
          type: string
          example: "attraction"
        travelTime:
          type: object
          properties:
            value:
              type: integer
              description: "이동 시간 (분)"
              example: 15
            text:
              type: string
              description: 표시용 텍스트
              example: "15분"
        rating:
          type: number
          format: float
          minimum: 0
          maximum: 5
          example: 4.3
        reviewCount:
          type: integer
          example: 5234
        address:
          type: string
          example: "Marienplatz, 80331 München, Germany"
        location:
          type: object
          properties:
            lat:
              type: number
              example: 48.1374
            lng:
              type: number
              example: 11.5755
        priceLevel:
          type: integer
          minimum: 1
          maximum: 4
          description: "가격 수준 (1: 저렴, 4: 매우 비쌈)"
        imageUrl:
          type: string
          nullable: true
          example: "https://maps.googleapis.com/maps/api/place/photo?..."

    PlaceDetailResponse:
      type: object
      properties:
        placeId:
          type: string
        placeName:
          type: string
        category:
          type: string
        rating:
          type: number
        reviewCount:
          type: integer
        priceLevel:
          type: integer
        location:
          type: object
          properties:
            address:
              type: string
              description: 전체 주소
            placeQuery:
              type: string
              description: 지도 검색용 키워드
              example: "Marienplatz, Munich"
            parkingQuery:
              type: string
              description: 주차장 검색어
              example: "Parkhaus Marienplatz"
            coordinates:
              type: object
              properties:
                lat:
                  type: number
                lng:
                  type: number
        businessHours:
          $ref: '#/components/schemas/BusinessHours'
        images:
          type: array
          items:
            type: string
          maxItems: 10
          description: "장소 이미지 URL 목록 (구글: 다수, 카카오: 1개)"
        contact:
          type: object
          properties:
            phone:
              type: string
              nullable: true
              description: "전화번호"
            website:
              type: string
              nullable: true
              description: "웹사이트 URL (구글만 제공)"
            placeUrl:
              type: string
              nullable: true
              description: "장소 상세 페이지 URL (카카오맵/구글맵)"
        amenities:
          type: object
          nullable: true
          description: "편의시설 정보 (주로 구글에서 제한적 제공)"
          properties:
            wheelchairAccessible:
              type: boolean
              nullable: true
              description: "휠체어 접근 가능 (구글)"
            parking:
              type: boolean
              nullable: true
              description: "주차 가능 (구글)"
            wifi:
              type: boolean
              nullable: true
              description: "와이파이 제공 (수동 입력)"
            creditCards:
              type: boolean
              nullable: true
              description: "신용카드 사용 가능 (수동 입력)"
        reviews:
          type: array
          items:
            $ref: '#/components/schemas/Review'
          maxItems: 5
          description: "최신 리뷰 (최대 5개)"
        aiRecommendation:
          $ref: '#/components/schemas/AIRecommendation'

    BusinessHours:
      type: object
      properties:
        isOpen:
          type: boolean
          description: 현재 영업 중 여부
        todayHours:
          type: object
          nullable: true
          properties:
            open:
              type: string
              format: time
              example: "09:00"
            close:
              type: string
              format: time
              example: "21:00"
            text:
              type: string
              example: "09:00 - 21:00"
        weeklyHours:
          type: array
          nullable: true
          items:
            type: object
            properties:
              dayOfWeek:
                type: integer
                minimum: 0
                maximum: 6
                description: "요일 (0: 일요일, 6: 토요일)"
              open:
                type: string
                format: time
                nullable: true
              close:
                type: string
                format: time
                nullable: true
              isOpen24Hours:
                type: boolean
                default: false
              isClosed:
                type: boolean
                default: false
        holiday:
          type: string
          nullable: true
          description: "휴무일 정보"
          example: "매주 월요일"
        lastOrder:
          type: string
          format: time
          nullable: true
          description: "라스트 오더 시간"
          example: "20:30"

    BusinessHoursResponse:
      type: object
      properties:
        placeId:
          type: string
        businessHours:
          $ref: '#/components/schemas/BusinessHours'
        lastUpdated:
          type: string
          format: date-time

    Review:
      type: object
      properties:
        authorName:
          type: string
          example: "John Doe"
        rating:
          type: integer
          minimum: 1
          maximum: 5
          example: 5
        text:
          type: string
          example: "정말 아름다운 광장입니다. 시계탑 공연이 인상적이었어요!"
        time:
          type: integer
          description: Unix timestamp
          example: 1704067200
        relativeTimeDescription:
          type: string
          example: "1주일 전"
        language:
          type: string
          example: "ko"

    AIRecommendation:
      type: object
      properties:
        recommendationId:
          type: string
        reasons:
          type: array
          items:
            type: object
            properties:
              type:
                type: string
                example: "member_fit"
              reason:
                type: string
                example: "아이들이 좋아하는 체험 활동이 있습니다"
        tips:
          type: object
          properties:
            description:
              type: string
              example: "뮌헨의 중심 광장으로, 중세 시대부터 이어진 역사적인 장소입니다"
            specialEvents:
              type: array
              items:
                type: string
              example: ["매시 정각 시계탑 인형극 공연"]
            bestVisitTime:
              type: string
              example: "오전 10시 (한적한 시간대)"
            estimatedDuration:
              type: string
              example: "1시간 30분"
            photoSpots:
              type: array
              items:
                type: string
              example: ["시계탑 정면", "분수대 앞"]
            practicalTips:
              type: array
              items:
                type: string
              example: ["편한 신발 착용", "우천 시 우산 필수"]
            weatherPreparation:
              type: array
              items:
                type: string
              example: ["여름철 선크림", "겨울철 방한복"]
            nearbyAlternatives:
              type: array
              items:
                type: object
                properties:
                  name:
                    type: string
                  distance:
                    type: string
                  reason:
                    type: string
        generatedAt:
          type: string
          format: date-time

    BatchPlaceRequest:
      type: object
      required:
        - placeIds
      properties:
        placeIds:
          type: array
          items:
            type: string
          minItems: 1
          maxItems: 50
          description: 조회할 장소 ID 목록
        fields:
          type: array
          items:
            type: string
            enum: [basic, rating, location, businessHours, images, contact, amenities, reviews, aiRecommendation]
          description: "포함할 필드 선택 (basic: placeId/placeName/category)"
          default: [basic, rating, location]

    BatchPlaceResponse:
      type: object
      properties:
        places:
          type: array
          items:
            $ref: '#/components/schemas/PlaceInfo'
        errors:
          type: array
          items:
            type: object
            properties:
              placeId:
                type: string
              error:
                type: string
          description: 조회 실패한 장소 목록
    
    PlaceInfo:
      type: object
      description: "fields 파라미터에 따라 선택적으로 포함되는 장소 정보"
      properties:
        # basic (필수)
        placeId:
          type: string
        placeName:
          type: string
        category:
          type: string
        # rating
        rating:
          type: number
          nullable: true
        reviewCount:
          type: integer
          nullable: true
        priceLevel:
          type: integer
          nullable: true
        # location
        location:
          type: object
          nullable: true
          properties:
            address:
              type: string
            coordinates:
              type: object
              properties:
                lat:
                  type: number
                lng:
                  type: number
        # businessHours
        businessHours:
          $ref: '#/components/schemas/BusinessHours'
          nullable: true
        # images
        images:
          type: array
          nullable: true
          items:
            type: string
          maxItems: 10
        # contact
        contact:
          type: object
          nullable: true
          properties:
            phone:
              type: string
              nullable: true
            website:
              type: string
              nullable: true
            placeUrl:
              type: string
              nullable: true
        # amenities
        amenities:
          type: object
          nullable: true
          properties:
            wheelchairAccessible:
              type: boolean
              nullable: true
            parking:
              type: boolean
              nullable: true
            wifi:
              type: boolean
              nullable: true
            creditCards:
              type: boolean
              nullable: true
        # reviews
        reviews:
          type: array
          nullable: true
          items:
            $ref: '#/components/schemas/Review'
          maxItems: 5
        # aiRecommendation
        aiRecommendation:
          $ref: '#/components/schemas/AIRecommendation'
          nullable: true

    GeocodeResponse:
      type: object
      properties:
        address:
          type: string
          description: 입력된 주소
        formattedAddress:
          type: string
          description: 정규화된 전체 주소
        location:
          type: object
          properties:
            lat:
              type: number
            lng:
              type: number
        components:
          type: object
          properties:
            streetNumber:
              type: string
            route:
              type: string
            locality:
              type: string
            administrativeAreaLevel1:
              type: string
            country:
              type: string
            postalCode:
              type: string

    ReverseGeocodeResponse:
      type: object
      properties:
        location:
          type: object
          properties:
            lat:
              type: number
            lng:
              type: number
        formattedAddress:
          type: string
        addressComponents:
          type: array
          items:
            type: object
            properties:
              longName:
                type: string
              shortName:
                type: string
              types:
                type: array
                items:
                  type: string

    DirectionsResponse:
      type: object
      properties:
        origin:
          type: string
        destination:
          type: string
        mode:
          type: string
        routes:
          type: array
          items:
            type: object
            properties:
              summary:
                type: string
                description: 경로 요약
              distance:
                type: object
                properties:
                  value:
                    type: integer
                    description: "거리 (미터)"
                  text:
                    type: string
                    example: "2.5 km"
              duration:
                type: object
                properties:
                  value:
                    type: integer
                    description: "소요 시간 (초)"
                  text:
                    type: string
                    example: "15분"
              steps:
                type: array
                items:
                  type: object
                  properties:
                    instruction:
                      type: string
                    distance:
                      type: object
                      properties:
                        value:
                          type: integer
                        text:
                          type: string
                    duration:
                      type: object
                      properties:
                        value:
                          type: integer
                        text:
                          type: string
                    travelMode:
                      type: string
              polyline:
                type: string
                description: 인코딩된 경로 폴리라인
              transitDetails:
                type: object
                nullable: true
                properties:
                  departureTime:
                    type: string
                    format: time
                  arrivalTime:
                    type: string
                    format: time
                  lines:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                        type:
                          type: string
                        color:
                          type: string

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: object
          properties:
            code:
              type: string
              example: "INVALID_REQUEST"
            message:
              type: string
              example: "요청이 올바르지 않습니다"
            details:
              type: object
              additionalProperties:
                type: string

tags:
  - name: Search
    description: 장소 검색 관련 API
  - name: Places
    description: 장소 정보 관련 API
  - name: Geocoding
    description: 지오코딩 관련 API
  - name: Directions
    description: 경로 안내 관련 API