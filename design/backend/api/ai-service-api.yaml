openapi: 3.0.0
info:
  title: AI Service API
  description: AI 기반 시간별 상세 일정 생성 및 장소 추천 정보 API
  version: 1.0.0
  contact:
    name: TripGen Development Team
    email: dev@tripgen.com

servers:
  - url: https://virtserver.swaggerhub.com/TRIPGEN/ai-service/1.0.0
    description: SwaggerHub API Auto Mocking
  - url: http://localhost:8083
    description: Local development server
  - url: https://api.tripgen.com/ai
    description: Production server

tags:
  - name: schedules
    description: AI 일정 생성
  - name: recommendations
    description: AI 추천 정보

paths:
  /schedules/generate:
    post:
      summary: AI 일정 생성 요청
      description: 여행 정보를 기반으로 AI가 최적화된 일정을 생성합니다
      operationId: generateAISchedule
      x-user-story: UFR-AI-010
      x-controller: AIScheduleController
      tags:
        - schedules
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GenerateScheduleRequest'
            example:
              tripId: "trip_202501_001"
              tripName: "독일 뮌헨 여행"
              transportMode: "car"
              startTime: "09:00"
              members:
                - name: "김철수"
                  age: 35
                  gender: "male"
                  healthStatus: "good"
                  preferences: ["sightseeing", "culture"]
                - name: "이영희"
                  age: 65
                  gender: "female"
                  healthStatus: "limited"
                  preferences: ["rest", "shopping"]
              destinations:
                - destinationName: "뮌헨"
                  nights: 3
                  startDate: "2025-09-01"
                  endDate: "2025-09-04"
                  accommodation: "뮌헨 센트럴 호텔"
                - destinationName: "프랑크푸르트"
                  nights: 2
                  startDate: "2025-09-04"
                  endDate: "2025-09-06"
                  accommodation: "프랑크푸르트 플라자"
              specialRequests: "박물관 위주로 일정을 짜주세요"
      responses:
        '202':
          description: 생성 요청 접수
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenerateScheduleResponse'
              example:
                requestId: "ai_req_202501_001"
                status: "processing"
                message: "AI 일정 생성이 시작되었습니다"
                estimatedTime: 5
        '400':
          $ref: '#/components/responses/BadRequest'
        '503':
          $ref: '#/components/responses/ServiceUnavailable'

  /schedules/{requestId}/status:
    get:
      summary: AI 일정 생성 상태 조회
      description: AI 일정 생성 진행 상황을 실시간으로 확인합니다
      operationId: getGenerationStatus
      x-user-story: UFR-AI-010
      x-controller: AIScheduleController
      tags:
        - schedules
      parameters:
        - name: requestId
          in: path
          required: true
          description: 생성 요청 ID
          schema:
            type: string
      responses:
        '200':
          description: 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenerationStatusResponse'
              example:
                requestId: "ai_req_202501_001"
                status: "processing"
                progress: 75
                currentStep: "장소 정보 분석 중"
                steps:
                  - step: "여행 정보 분석"
                    status: "completed"
                  - step: "날씨 정보 조회"
                    status: "completed"
                  - step: "장소 정보 분석"
                    status: "processing"
                  - step: "일정 최적화"
                    status: "pending"
                estimatedTime: 2
        '404':
          $ref: '#/components/responses/NotFound'

  /schedules/{requestId}:
    get:
      summary: 생성된 AI 일정 조회
      description: AI가 생성한 일정을 조회합니다
      operationId: getGeneratedSchedule
      x-user-story: UFR-AI-010
      x-controller: AIScheduleController
      tags:
        - schedules
      parameters:
        - name: requestId
          in: path
          required: true
          description: 생성 요청 ID
          schema:
            type: string
      responses:
        '200':
          description: 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GeneratedScheduleResponse'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      summary: AI 일정 생성 취소
      description: 진행 중인 AI 일정 생성을 취소합니다
      operationId: cancelGeneration
      x-user-story: UFR-AI-010
      x-controller: AIScheduleController
      tags:
        - schedules
      parameters:
        - name: requestId
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: 취소 성공
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: 이미 완료된 작업
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /schedules/regenerate:
    post:
      summary: 일자별 일정 재생성
      description: 특정 날짜의 일정만 다시 생성합니다
      operationId: regenerateDaySchedule
      x-user-story: UFR-AI-010
      x-controller: AIScheduleController
      tags:
        - schedules
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegenerateScheduleRequest'
            example:
              tripId: "trip_202501_001"
              day: 2
              existingSchedules:
                - day: 1
                  places: ["place_001", "place_002", "place_003"]
                - day: 3
                  places: ["place_007", "place_008", "place_009"]
              specialRequests: "실내 활동 위주로 변경해주세요"
      responses:
        '202':
          description: 재생성 요청 접수
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenerateScheduleResponse'
        '400':
          $ref: '#/components/responses/BadRequest'

  /places/{placeId}/recommendations:
    post:
      summary: AI 추천 정보 생성
      description: 특정 장소에 대한 AI 맞춤형 추천 정보를 생성합니다
      operationId: generatePlaceRecommendations
      x-user-story: UFR-AI-020
      x-controller: AIRecommendationController
      tags:
        - recommendations
      parameters:
        - name: placeId
          in: path
          required: true
          description: 장소 ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RecommendationRequest'
            example:
              placeName: "마리엔플라츠"
              placeType: "landmark"
              placeAddress: "Marienplatz, 80331 München, Germany"
              userProfile:
                memberComposition: "가족 여행 (어린이 포함)"
                healthStatus: "주의"
                transportMode: "public"
                preferences: ["culture", "sightseeing"]
              tripContext:
                visitDate: "2025-09-02"
                visitTime: "14:00"
                previousPlace: "뮌헨 레지덴츠"
                nextPlace: "호프브로이하우스"
      responses:
        '200':
          description: 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RecommendationResponse'
              example:
                placeId: "place_marienplatz"
                recommendations:
                  reasons:
                    - "아이들이 좋아하는 시계탑 인형극이 매시 정각에 열립니다"
                    - "평탄한 광장으로 이동이 편리합니다"
                    - "지하철역과 직접 연결되어 대중교통 접근이 용이합니다"
                  tips:
                    description: "뮌헨의 중심 광장으로 1158년부터 시장이 열렸던 역사적 장소입니다"
                    events:
                      - "매일 11시, 12시, 17시에 시계탑 인형극 공연"
                      - "겨울에는 크리스마스 마켓 개최"
                    bestVisitTime: "오전 10시 (한적한 시간대)"
                    estimatedDuration: "1시간 30분"
                    photoSpots:
                      - "시계탑 정면에서 전체 건물 촬영"
                      - "분수대 앞에서 광장 전경 촬영"
                    practicalTips:
                      - "광장 주변 카페에서 휴식 가능"
                      - "우천 시 시청사 내부 관람 추천"
                      - "여름철에는 그늘이 적어 모자 필수"
                    alternativePlaces:
                      - name: "빅투알리엔 마르크트"
                        reason: "날씨가 좋지 않을 때 실내 시장"
                        distance: "도보 5분"
        '400':
          $ref: '#/components/responses/BadRequest'
        '503':
          $ref: '#/components/responses/ServiceUnavailable'

  /trips/{tripId}/weather-impact:
    post:
      summary: 날씨 영향 분석
      description: 날씨 변화가 일정에 미치는 영향을 분석합니다
      operationId: analyzeWeatherImpact
      x-user-story: UFR-TRIP-062
      x-controller: AIScheduleController
      tags:
        - schedules
      parameters:
        - name: tripId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WeatherImpactRequest'
      responses:
        '200':
          description: 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WeatherImpactResponse'
        '400':
          $ref: '#/components/responses/BadRequest'

components:
  schemas:
    GenerateScheduleRequest:
      type: object
      required:
        - tripId
        - tripName
        - transportMode
        - startTime
        - members
        - destinations
      properties:
        tripId:
          type: string
          description: 여행 ID
        tripName:
          type: string
          description: 여행명
        transportMode:
          type: string
          enum: [public, car]
          description: 선호 이동수단
        startTime:
          type: string
          pattern: '^([01]?[0-9]|2[0-3]):[0-5][0-9]$'
          description: 일일 시작 시간
        members:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
              age:
                type: integer
              gender:
                type: string
                enum: [male, female]
              healthStatus:
                type: string
                enum: [excellent, good, caution, limited]
              preferences:
                type: array
                items:
                  type: string
          minItems: 1
          description: 여행 멤버 정보
        destinations:
          type: array
          items:
            type: object
            properties:
              destinationName:
                type: string
              nights:
                type: integer
              startDate:
                type: string
                format: date
              endDate:
                type: string
                format: date
              accommodation:
                type: string
              checkInTime:
                type: string
              checkOutTime:
                type: string
          minItems: 1
          description: 여행지 정보
        specialRequests:
          type: string
          maxLength: 500
          description: 특별 요청사항

    GenerateScheduleResponse:
      type: object
      properties:
        requestId:
          type: string
          description: 생성 요청 ID
        status:
          type: string
          enum: [queued, processing, completed, failed]
        message:
          type: string
        estimatedTime:
          type: integer
          description: 예상 소요 시간 (초)

    GenerationStatusResponse:
      type: object
      properties:
        requestId:
          type: string
        status:
          type: string
          enum: [queued, processing, completed, failed]
        progress:
          type: integer
          minimum: 0
          maximum: 100
        currentStep:
          type: string
          description: 현재 진행 중인 단계
        steps:
          type: array
          items:
            type: object
            properties:
              step:
                type: string
              status:
                type: string
                enum: [pending, processing, completed]
        estimatedTime:
          type: integer
          description: 예상 남은 시간 (초)
        error:
          type: string
          description: 오류 메시지 (실패 시)

    GeneratedScheduleResponse:
      type: object
      properties:
        requestId:
          type: string
        tripId:
          type: string
        status:
          type: string
          enum: [completed, failed]
        generatedAt:
          type: string
          format: date-time
        schedules:
          type: array
          items:
            type: object
            properties:
              day:
                type: integer
              date:
                type: string
                format: date
              destinationName:
                type: string
              weather:
                type: object
                properties:
                  condition:
                    type: string
                  temperature:
                    type: object
                    properties:
                      min:
                        type: number
                      max:
                        type: number
                  precipitation:
                    type: number
                    description: 강수확률 (%)
                  warnings:
                    type: array
                    items:
                      type: string
              places:
                type: array
                items:
                  type: object
                  properties:
                    placeId:
                      type: string
                    placeName:
                      type: string
                    category:
                      type: string
                    startTime:
                      type: string
                    duration:
                      type: integer
                      description: 소요 시간 (분)
                    transportation:
                      type: object
                      properties:
                        type:
                          type: string
                          enum: [walk, car, public]
                        duration:
                          type: integer
                        distance:
                          type: number
                        route:
                          type: string
                        parkingInfo:
                          type: object
                          properties:
                            name:
                              type: string
                            distance:
                              type: string
                            estimatedCost:
                              type: string
                    healthConsideration:
                      type: object
                      properties:
                        restPoints:
                          type: array
                          items:
                            type: string
                        optionalActivities:
                          type: object
                          properties:
                            basic:
                              type: string
                            active:
                              type: string
                        accessibility:
                          type: array
                          items:
                            type: string
                        walkingDistance:
                          type: number
                    weatherConsideration:
                      type: object
                      properties:
                        indoorAlternative:
                          type: string
                        preparationItems:
                          type: array
                          items:
                            type: string
        metadata:
          type: object
          properties:
            totalDays:
              type: integer
            totalPlaces:
              type: integer
            healthStatusConsidered:
              type: string
            weatherConsidered:
              type: boolean

    RegenerateScheduleRequest:
      type: object
      required:
        - tripId
        - day
      properties:
        tripId:
          type: string
        day:
          type: integer
          minimum: 1
        existingSchedules:
          type: array
          items:
            type: object
            properties:
              day:
                type: integer
              places:
                type: array
                items:
                  type: string
          description: 다른 날짜의 기존 일정 (연속성 유지용)
        specialRequests:
          type: string
          maxLength: 500

    RecommendationRequest:
      type: object
      required:
        - placeName
        - placeType
        - userProfile
      properties:
        placeName:
          type: string
        placeType:
          type: string
        placeAddress:
          type: string
        userProfile:
          type: object
          properties:
            memberComposition:
              type: string
            healthStatus:
              type: string
            transportMode:
              type: string
            preferences:
              type: array
              items:
                type: string
        tripContext:
          type: object
          properties:
            visitDate:
              type: string
              format: date
            visitTime:
              type: string
            previousPlace:
              type: string
            nextPlace:
              type: string

    RecommendationResponse:
      type: object
      properties:
        placeId:
          type: string
        recommendations:
          type: object
          properties:
            reasons:
              type: array
              items:
                type: string
              description: 추천 이유 (프로파일 기반)
            tips:
              type: object
              properties:
                description:
                  type: string
                  description: 장소 설명
                events:
                  type: array
                  items:
                    type: string
                  description: 특별 이벤트
                bestVisitTime:
                  type: string
                  description: 추천 방문 시간
                estimatedDuration:
                  type: string
                  description: 예상 소요 시간
                photoSpots:
                  type: array
                  items:
                    type: string
                  description: 포토 스팟
                practicalTips:
                  type: array
                  items:
                    type: string
                  description: 실용적 팁
                alternativePlaces:
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        type: string
                      reason:
                        type: string
                      distance:
                        type: string
                  description: 대체 장소
        generatedAt:
          type: string
          format: date-time
        cacheExpiry:
          type: string
          format: date-time

    WeatherImpactRequest:
      type: object
      required:
        - schedules
        - weatherChanges
      properties:
        schedules:
          type: array
          items:
            type: object
            properties:
              day:
                type: integer
              date:
                type: string
                format: date
              places:
                type: array
                items:
                  type: object
                  properties:
                    placeId:
                      type: string
                    isOutdoor:
                      type: boolean
        weatherChanges:
          type: array
          items:
            type: object
            properties:
              date:
                type: string
                format: date
              previousCondition:
                type: string
              newCondition:
                type: string
              severity:
                type: string
                enum: [low, medium, high]

    WeatherImpactResponse:
      type: object
      properties:
        impactedDays:
          type: array
          items:
            type: object
            properties:
              day:
                type: integer
              date:
                type: string
                format: date
              reason:
                type: string
              affectedPlaces:
                type: array
                items:
                  type: string
              recommendation:
                type: string
                enum: [regenerate, modify, keep]
              alternativeOptions:
                type: array
                items:
                  type: string

    Error:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
        message:
          type: string
        details:
          type: object

  responses:
    BadRequest:
      description: 잘못된 요청
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            code: "INVALID_REQUEST"
            message: "필수 항목이 누락되었습니다"

    NotFound:
      description: 리소스를 찾을 수 없음
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            code: "NOT_FOUND"
            message: "요청 ID를 찾을 수 없습니다"

    ServiceUnavailable:
      description: 서비스 일시적 사용 불가
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            code: "SERVICE_UNAVAILABLE"
            message: "AI 서비스가 일시적으로 사용할 수 없습니다"