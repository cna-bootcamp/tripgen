# 여행 일정 생성 서비스 - 물리 아키텍처 설계서

## 1. 개요

본 문서는 여행 일정 생성 서비스의 Azure Cloud 기반 물리 아키텍처를 정의합니다. MVP(Minimum Viable Product) 구현을 위해 최소한의 구성으로 설계되었으며, 확장성과 유지보수성을 고려하여 설계되었습니다.

## 2. 아키텍처 원칙

- **MVP 우선**: 핵심 기능 구현에 필요한 최소 구성
- **확장성**: 향후 트래픽 증가에 대응 가능한 구조
- **비용 효율성**: 오픈소스 솔루션 활용으로 비용 최적화
- **관리형 서비스 활용**: 메시지 큐는 Azure 관리형 서비스 사용

## 3. 인프라 구성

### 3.1 네트워크 구성

#### Azure Virtual Network (tripgen-vnet)
- **목적**: 모든 리소스를 위한 격리된 네트워크 환경 제공
- **서브넷 구성**:
  - **AKS Subnet (tripgen-aks-subnet)**: Kubernetes 클러스터용
  - **Database Subnet (tripgen-db-subnet)**: 데이터베이스 VM용
  - **Cache Subnet (tripgen-cache-subnet)**: Redis 캐시 VM용

### 3.2 프론트엔드 구성

#### Azure Static Web Apps
- **목적**: React 애플리케이션 호스팅
- **특징**: 자동 CI/CD, SSL 인증서 관리

#### Azure CDN
- **목적**: 정적 콘텐츠 전송 최적화
- **특징**: 글로벌 엣지 네트워크, 캐싱

### 3.3 컨테이너 환경

#### Azure Container Registry (ACR)
- **목적**: Docker 이미지 저장 및 관리
- **특징**: 프라이빗 레지스트리, 보안 스캔

#### Azure Kubernetes Service (AKS)
- **구성**:
  - **Node Pool**: Standard_D4s_v3 (3 nodes)
  - **Auto-scaling**: 3-10 nodes
  - **Kubernetes Version**: 1.28+
  - **Network Policy**: Azure CNI

### 3.4 마이크로서비스 구성

#### API Gateway
- **솔루션**: Spring Cloud Gateway
- **역할**: API 라우팅, 인증/인가, 레이트 리미팅

#### 마이크로서비스
1. **Profile Service**
   - **Replicas**: 3
   - **역할**: 멤버 및 여행 정보 관리

2. **Itinerary Service**
   - **Replicas**: 5
   - **역할**: AI 기반 일정 생성 및 관리

3. **Location Service**
   - **Replicas**: 3
   - **역할**: 장소 검색 및 검증

### 3.5 데이터 계층

#### PostgreSQL (VM 기반)
- **구성**: 서비스별 독립 DB
  - Profile DB VM
  - Itinerary DB VM
  - Location DB VM
- **VM 사양**: Standard_D2s_v3
- **OS**: Ubuntu 22.04 LTS
- **PostgreSQL 버전**: 15
- **스토리지**: Premium SSD
- **백업**: Azure Backup 일일 백업

#### Redis Cache (VM 기반)
- **구성**: 3-node 클러스터
- **VM 사양**: Standard_D2s_v3
- **Redis 버전**: 7.0
- **특징**:
  - AOF 영속성 활성화
  - allkeys-lru 메모리 정책

### 3.6 메시징 계층

#### Azure Service Bus
- **티어**: Standard
- **큐 구성**:
  - Itinerary Generation Queue
  - Validation Queue
  - Notification Queue
- **특징**:
  - 파티션된 큐
  - 메시지 TTL: 24시간
  - Dead Letter Queue 활성화

### 3.7 외부 연동

#### External Services
- **Claude API**: AI 일정 생성
- **Kakao Local API**: 장소 검색
- **Weather API**: 날씨 정보
- **Transport API**: 교통 정보

## 4. 데이터 플로우

1. **클라이언트 요청**
   - CDN → Static Web Apps → Azure Load Balancer

2. **API 처리**
   - Load Balancer → NGINX Ingress → Spring Cloud Gateway → 마이크로서비스

3. **데이터 저장**
   - 각 서비스는 독립적인 PostgreSQL DB 사용
   - Redis를 통한 캐싱

4. **비동기 처리**
   - Azure Service Bus를 통한 이벤트 기반 통신

5. **외부 API 호출**
   - HTTPS를 통한 안전한 통신

## 5. 보안 고려사항

- **네트워크 격리**: VNet 및 서브넷을 통한 격리
- **통신 암호화**: 모든 외부 통신은 HTTPS 사용
- **접근 제어**: Spring Cloud Gateway에서 인증/인가 처리

## 6. 확장성 전략

- **수평적 확장**: AKS auto-scaling (3-10 nodes)
- **서비스별 독립 확장**: Pod replicas 조정
- **캐시 활용**: Redis를 통한 부하 분산

## 7. 향후 고려사항

- 모니터링 및 로깅 시스템 추가 (Azure Monitor, Application Insights)
- 보안 강화 (WAF, DDoS Protection)
- 고가용성 구성 (Multi-region deployment)
- 백업 및 재해 복구 전략 수립