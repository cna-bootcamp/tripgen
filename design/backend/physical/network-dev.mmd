graph TB
    %% TripGen ì„œë¹„ìŠ¤ ê°œë°œí™˜ê²½ ë„¤íŠ¸ì›Œí¬ ë‹¤ì´ì–´ê·¸ë¨
    %% Azure í´ë¼ìš°ë“œ ê¸°ë°˜ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜

    %% ì™¸ë¶€ ì˜ì—­
    subgraph Internet["ğŸŒ ì¸í„°ë„·"]
        Developer["ğŸ‘¨â€ğŸ’» ê°œë°œì"]
        QATester["ğŸ§ª QA í…ŒìŠ¤í„°"]
    end

    %% Azure í´ë¼ìš°ë“œ ê°œë°œí™˜ê²½
    subgraph AzureCloud["â˜ï¸ Azure Cloud - ê°œë°œí™˜ê²½"]
        
        %% Virtual Network
        subgraph VNet["ğŸ¢ Virtual Network<br/>ì£¼ì†Œ: 10.1.0.0/16"]
            
            %% Public Subnet - ì™¸ë¶€ ì§„ì…ì 
            subgraph PublicSubnet["ğŸŒ Public Subnet (10.1.1.0/24)"]
                LoadBalancer["âš–ï¸ Azure Load Balancer<br/>Public IP: dev-tripgen.eastasia.cloudapp.azure.com"]
            end

            %% Private Subnet - AKS í´ëŸ¬ìŠ¤í„°
            subgraph PrivateSubnet["ğŸ”’ Private Subnet (10.1.2.0/24)"]
                
                subgraph AKSCluster["âš™ï¸ AKS Cluster"]
                    
                    %% Ingress Controller
                    IngressController["ğŸšª NGINX Ingress<br/>NodePort: 30080/30443"]
                    
                    %% ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤
                    subgraph MicroServices["ğŸš€ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤"]
                        UserService["ğŸ‘¤ User Service<br/>Replicas: 2<br/>Port: 8080"]
                        TripService["ğŸ—ºï¸ Trip Service<br/>Replicas: 2<br/>Port: 8080"]
                        AIService["ğŸ¤– AI Service<br/>Replicas: 1<br/>Port: 8080"]
                        LocationService["ğŸ“ Location Service<br/>Replicas: 2<br/>Port: 8080"]
                    end
                    
                    %% ë°ì´í„° ì €ì¥ì†Œ
                    subgraph DataTier["ğŸ’¾ ë°ì´í„° ì €ì¥ì†Œ"]
                        PostgreSQL["ğŸ˜ PostgreSQL<br/>Port: 5432<br/>Storage: 100GB"]
                        Redis["ğŸ”´ Redis<br/>Port: 6379<br/>Memory: 2GB"]
                    end
                end
            end

            %% Service Bus Subnet
            subgraph MessageSubnet["ğŸ“¨ Message Subnet (10.1.3.0/24)"]
                
                subgraph ServiceBus["ğŸ“® Azure Service Bus"]
                    ServiceBusEndpoint["ğŸ”— tripgen-dev-sb.servicebus.windows.net"]
                    
                    subgraph Queues["ğŸ“¬ ë©”ì‹œì§€ í"]
                        AIQueue["ğŸ¤– ai-schedule-generation"]
                        LocationQueue["ğŸ“ location-search"]
                        NotificationQueue["ğŸ”” notification"]
                    end
                end
            end
        end

        %% Azure ê´€ë¦¬ ì„œë¹„ìŠ¤
        subgraph AzureServices["ğŸ› ï¸ Azure ê´€ë¦¬ ì„œë¹„ìŠ¤"]
            LogAnalytics["ğŸ“Š Log Analytics"]
            AppInsights["ğŸ“ˆ Application Insights"]
            KeyVault["ğŸ” Key Vault<br/>Secrets & Configs"]
            ContainerRegistry["ğŸ“¦ Container Registry"]
        end

        %% ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ ê·¸ë£¹
        subgraph SecurityGroups["ğŸ”’ Network Security Groups"]
            PublicNSG["ğŸŒ Public NSG<br/>â€¢ HTTPS:443 (Allow)<br/>â€¢ HTTP:80 (Allow)"]
            PrivateNSG["ğŸ”’ Private NSG<br/>â€¢ Port:8080 (Internal)<br/>â€¢ Port:5432 (DB)<br/>â€¢ Port:6379 (Cache)"]
            MessageNSG["ğŸ“¨ Message NSG<br/>â€¢ HTTPS:443 (App only)<br/>â€¢ AMQP:5671 (App only)"]
        end
    end

    %% ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ íë¦„

    %% ì™¸ë¶€ â†’ ë‚´ë¶€ íŠ¸ë˜í”½
    Developer -->|"HTTPS:443"| LoadBalancer
    QATester -->|"API í…ŒìŠ¤íŠ¸"| LoadBalancer

    %% Load Balancer â†’ Ingress
    LoadBalancer -->|"NodePort"| IngressController

    %% Ingress â†’ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤
    IngressController -->|"/api/users/**"| UserService
    IngressController -->|"/api/trips/**"| TripService
    IngressController -->|"/api/ai/**"| AIService
    IngressController -->|"/api/locations/**"| LocationService

    %% ì„œë¹„ìŠ¤ ê°„ í†µì‹ 
    UserService <-->|"REST API:8080"| TripService
    TripService <-->|"REST API:8080"| AIService
    AIService <-->|"REST API:8080"| LocationService

    %% ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°
    UserService -->|"JDBC:5432"| PostgreSQL
    TripService -->|"JDBC:5432"| PostgreSQL
    AIService -->|"JDBC:5432"| PostgreSQL
    LocationService -->|"JDBC:5432"| PostgreSQL

    %% ìºì‹œ ì—°ê²°
    UserService -->|"Redis:6379"| Redis
    TripService -->|"Redis:6379"| Redis
    AIService -->|"Redis:6379"| Redis
    LocationService -->|"Redis:6379"| Redis

    %% ë©”ì‹œì§• ì—°ê²°
    AIService -->|"AMQP/HTTPS"| ServiceBusEndpoint
    LocationService -->|"AMQP/HTTPS"| ServiceBusEndpoint
    TripService -->|"AMQP/HTTPS"| ServiceBusEndpoint

    ServiceBusEndpoint --> AIQueue
    ServiceBusEndpoint --> LocationQueue
    ServiceBusEndpoint --> NotificationQueue

    %% ëª¨ë‹ˆí„°ë§ & ë³´ì•ˆ
    MicroServices -->|"Logs & Metrics"| LogAnalytics
    MicroServices -->|"APM"| AppInsights
    MicroServices -->|"Secrets"| KeyVault
    AKSCluster -->|"Image Pull"| ContainerRegistry

    %% NSG ì ìš©
    PublicSubnet -.->|"ë³´ì•ˆ ê·œì¹™"| PublicNSG
    PrivateSubnet -.->|"ë³´ì•ˆ ê·œì¹™"| PrivateNSG
    MessageSubnet -.->|"ë³´ì•ˆ ê·œì¹™"| MessageNSG

    %% ìŠ¤íƒ€ì¼ ì •ì˜
    classDef azureStyle fill:#0078D4,stroke:#fff,stroke-width:2px,color:#fff
    classDef networkStyle fill:#1E90FF,stroke:#fff,stroke-width:2px,color:#fff
    classDef k8sStyle fill:#326CE5,stroke:#fff,stroke-width:2px,color:#fff
    classDef appStyle fill:#28A745,stroke:#fff,stroke-width:2px,color:#fff
    classDef dataStyle fill:#DC3545,stroke:#fff,stroke-width:2px,color:#fff
    classDef messageStyle fill:#FD7E14,stroke:#fff,stroke-width:2px,color:#fff
    classDef securityStyle fill:#6F42C1,stroke:#fff,stroke-width:2px,color:#fff
    classDef managedStyle fill:#17A2B8,stroke:#fff,stroke-width:2px,color:#fff

    %% ìŠ¤íƒ€ì¼ ì ìš©
    class AzureCloud azureStyle
    class VNet,PublicSubnet,PrivateSubnet,MessageSubnet networkStyle
    class AKSCluster,IngressController k8sStyle
    class MicroServices,UserService,TripService,AIService,LocationService appStyle
    class DataTier,PostgreSQL,Redis dataStyle
    class ServiceBus,ServiceBusEndpoint,Queues,AIQueue,LocationQueue,NotificationQueue messageStyle
    class SecurityGroups,PublicNSG,PrivateNSG,MessageNSG,KeyVault securityStyle
    class AzureServices,LogAnalytics,AppInsights,ContainerRegistry managedStyle