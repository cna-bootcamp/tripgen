graph TB
    %% ê°œë°œí™˜ê²½ ë„¤íŠ¸ì›Œí¬ ë‹¤ì´ì–´ê·¸ë¨
    %% AI ê¸°ë°˜ ì—¬í–‰ ì¼ì • ìƒì„± ì„œë¹„ìŠ¤ - ê°œë°œí™˜ê²½

    %% ì™¸ë¶€ ì˜ì—­
    subgraph Internet["ğŸŒ ì¸í„°ë„·"]
        Developer["ğŸ‘¨â€ğŸ’» ê°œë°œì"]
        QATester["ğŸ§ª QAíŒ€"]
    end

    %% Azure í´ë¼ìš°ë“œ ì˜ì—­
    subgraph AzureCloud["â˜ï¸ Azure Cloud"]
        
        %% Virtual Network
        subgraph VNet["ğŸ¢ Virtual Network (VNet)<br/>ì£¼ì†Œ ê³µê°„: 10.0.0.0/16"]
            
            %% AKS ì„œë¸Œë„·
            subgraph AKSSubnet["ğŸ¯ AKS Subnet<br/>10.0.1.0/24"]
                
                %% Kubernetes í´ëŸ¬ìŠ¤í„°
                subgraph AKSCluster["âš™ï¸ AKS Cluster"]
                    
                    %% Ingress Controller
                    subgraph IngressController["ğŸšª NGINX Ingress Controller"]
                        LoadBalancer["âš–ï¸ LoadBalancer Service<br/>(External IP)"]
                        IngressPod["ğŸ“¦ Ingress Controller Pod"]
                    end
                    
                    %% Application Tier
                    subgraph AppTier["ğŸš€ Application Tier"]
                        UserService["ğŸ‘¤ User Service<br/>Pod"]
                        TripService["ğŸ—ºï¸ Trip Service<br/>Pod"]
                        AIService["ğŸ¤– AI Service<br/>Pod"]
                        LocationService["ğŸ“ Location Service<br/>Pod"]
                    end
                    
                    %% Database Tier
                    subgraph DBTier["ğŸ—„ï¸ Database Tier"]
                        PostgreSQL["ğŸ˜ PostgreSQL<br/>Pod"]
                        PostgreSQLStorage["ğŸ’¾ hostPath Volume<br/>(/data/postgresql)"]
                    end
                    
                    %% Cache Tier
                    subgraph CacheTier["âš¡ Cache Tier"]
                        Redis["ğŸ”´ Redis<br/>Pod"]
                    end
                    
                    %% Cluster Internal Services
                    subgraph ClusterServices["ğŸ”— ClusterIP Services"]
                        UserServiceDNS["user-service:8080"]
                        TripServiceDNS["trip-service:8080"]
                        AIServiceDNS["ai-service:8080"]
                        LocationServiceDNS["location-service:8080"]
                        PostgreSQLDNS["postgresql:5432"]
                        RedisDNS["redis:6379"]
                    end
                end
            end
            
            %% Service Bus ì„œë¸Œë„·
            subgraph ServiceBusSubnet["ğŸ“¨ Service Bus Subnet<br/>10.0.2.0/24"]
                ServiceBus["ğŸ“® Azure Service Bus<br/>(Basic Tier)"]
                
                subgraph Queues["ğŸ“¬ Message Queues"]
                    AIQueue["ğŸ¤– ai-schedule-generation"]
                    LocationQueue["ğŸ“ location-search"]
                    NotificationQueue["ğŸ”” notification"]
                end
            end
        end
    end

    %% ë„¤íŠ¸ì›Œí¬ ì—°ê²° ê´€ê³„

    %% ì™¸ë¶€ì—ì„œ í´ëŸ¬ìŠ¤í„°ë¡œì˜ ì ‘ê·¼
    Developer -->|"HTTPS:443<br/>(ê°œë°œìš© ë„ë©”ì¸)"| LoadBalancer
    QATester -->|"API í˜¸ì¶œ/í…ŒìŠ¤íŠ¸"| LoadBalancer

    %% Ingress Controller ë‚´ë¶€ íë¦„
    LoadBalancer -->|"íŠ¸ë˜í”½ ë¼ìš°íŒ…"| IngressPod

    %% Ingressì—ì„œ Application Servicesë¡œ
    IngressPod -->|"/api/users/**"| UserServiceDNS
    IngressPod -->|"/api/trips/**"| TripServiceDNS
    IngressPod -->|"/api/ai/**"| AIServiceDNS
    IngressPod -->|"/api/locations/**"| LocationServiceDNS

    %% ClusterIP Servicesì—ì„œ ì‹¤ì œ Podë¡œ
    UserServiceDNS -->|"ë‚´ë¶€ ë¡œë“œë°¸ëŸ°ì‹±"| UserService
    TripServiceDNS -->|"ë‚´ë¶€ ë¡œë“œë°¸ëŸ°ì‹±"| TripService
    AIServiceDNS -->|"ë‚´ë¶€ ë¡œë“œë°¸ëŸ°ì‹±"| AIService
    LocationServiceDNS -->|"ë‚´ë¶€ ë¡œë“œë°¸ëŸ°ì‹±"| LocationService

    %% Application Servicesì—ì„œ Databaseë¡œ
    UserService -->|"DB ì—°ê²°<br/>TCP:5432"| PostgreSQLDNS
    TripService -->|"DB ì—°ê²°<br/>TCP:5432"| PostgreSQLDNS
    AIService -->|"DB ì—°ê²°<br/>TCP:5432"| PostgreSQLDNS
    LocationService -->|"DB ì—°ê²°<br/>TCP:5432"| PostgreSQLDNS

    %% Application Servicesì—ì„œ Cacheë¡œ
    UserService -->|"ìºì‹œ ì—°ê²°<br/>TCP:6379"| RedisDNS
    TripService -->|"ìºì‹œ ì—°ê²°<br/>TCP:6379"| RedisDNS
    AIService -->|"ìºì‹œ ì—°ê²°<br/>TCP:6379"| RedisDNS
    LocationService -->|"ìºì‹œ ì—°ê²°<br/>TCP:6379"| RedisDNS

    %% ClusterIP Servicesì—ì„œ ì‹¤ì œ Podë¡œ (Database/Cache)
    PostgreSQLDNS -->|"DB ìš”ì²­ ì²˜ë¦¬"| PostgreSQL
    RedisDNS -->|"ìºì‹œ ìš”ì²­ ì²˜ë¦¬"| Redis

    %% Storage ì—°ê²°
    PostgreSQL -->|"ë°ì´í„° ì˜ì†í™”"| PostgreSQLStorage

    %% Service Bus ì—°ê²°
    AIService -->|"ë¹„ë™ê¸° ë©”ì‹œì§•<br/>HTTPS/AMQP"| ServiceBus
    LocationService -->|"ë¹„ë™ê¸° ë©”ì‹œì§•<br/>HTTPS/AMQP"| ServiceBus
    TripService -->|"ì•Œë¦¼ ë©”ì‹œì§•<br/>HTTPS/AMQP"| ServiceBus

    ServiceBus --> AIQueue
    ServiceBus --> LocationQueue
    ServiceBus --> NotificationQueue

    %% ìŠ¤íƒ€ì¼ ì •ì˜
    classDef azureStyle fill:#0078D4,stroke:#fff,stroke-width:2px,color:#fff
    classDef k8sStyle fill:#326CE5,stroke:#fff,stroke-width:2px,color:#fff
    classDef appStyle fill:#28A745,stroke:#fff,stroke-width:2px,color:#fff
    classDef dbStyle fill:#DC3545,stroke:#fff,stroke-width:2px,color:#fff
    classDef cacheStyle fill:#FF6B35,stroke:#fff,stroke-width:2px,color:#fff
    classDef serviceStyle fill:#6610F2,stroke:#fff,stroke-width:2px,color:#fff
    classDef queueStyle fill:#FD7E14,stroke:#fff,stroke-width:2px,color:#fff

    %% ìŠ¤íƒ€ì¼ ì ìš©
    class AzureCloud,VNet azureStyle
    class AKSCluster,AKSSubnet,IngressController k8sStyle
    class AppTier,UserService,TripService,AIService,LocationService appStyle
    class DBTier,PostgreSQL,PostgreSQLStorage dbStyle
    class CacheTier,Redis cacheStyle
    class ClusterServices,UserServiceDNS,TripServiceDNS,AIServiceDNS,LocationServiceDNS,PostgreSQLDNS,RedisDNS serviceStyle
    class ServiceBus,ServiceBusSubnet,Queues,AIQueue,LocationQueue,NotificationQueue queueStyle