graph TB
    %% TripGen ì„œë¹„ìŠ¤ ìš´ì˜í™˜ê²½ ë„¤íŠ¸ì›Œí¬ ë‹¤ì´ì–´ê·¸ë¨
    %% Azure í´ë¼ìš°ë“œ ê¸°ë°˜ ì—”í„°í”„ë¼ì´ì¦ˆ ë³´ì•ˆ ì•„í‚¤í…ì²˜
    
    %% ì™¸ë¶€ ì˜ì—­
    subgraph Internet["ğŸŒ ì¸í„°ë„·"]
        Users["ğŸ‘¥ ìµœì¢… ì‚¬ìš©ì<br/>(1ë§Œ~10ë§Œ ë™ì‹œ ì ‘ì†)"]
        AttackSources["ğŸ”¥ ìœ„í˜‘ ì†ŒìŠ¤<br/>(DDoS, ì•…ì„± íŠ¸ë˜í”½)"]
    end
    
    %% Azure í´ë¼ìš°ë“œ ìš´ì˜í™˜ê²½
    subgraph AzureCloud["â˜ï¸ Azure Cloud - ìš´ì˜í™˜ê²½"]
        
        %% ê¸€ë¡œë²Œ ë³´ì•ˆ ì„œë¹„ìŠ¤
        subgraph GlobalSecurity["ğŸ›¡ï¸ ê¸€ë¡œë²Œ ë³´ì•ˆ ì„œë¹„ìŠ¤"]
            AFD["ğŸŒ Azure Front Door<br/>Premium WAF + CDN"]
            DDoSProtection["ğŸ›¡ï¸ DDoS Protection Standard"]
        end
        
        %% Hub VNet - ì¤‘ì•™ ë³´ì•ˆ í—ˆë¸Œ
        subgraph HubVNet["ğŸ¢ Hub VNet (10.0.0.0/16)"]
            
            %% ì™¸ë¶€ ì§„ì…ì  (DMZ)
            subgraph DMZSubnet["ğŸšª DMZ Subnet (10.0.1.0/24)"]
                subgraph AppGateway["ğŸ” Application Gateway v2"]
                    PublicIP["ğŸ“ Static Public IP<br/>DDoS Protected"]
                    WAF["ğŸ›¡ï¸ WAF v2<br/>OWASP CRS 3.2"]
                    SSLTermination["ğŸ”’ SSL Termination<br/>TLS 1.3"]
                end
            end
            
            %% Azure Firewall
            subgraph FirewallSubnet["ğŸ”¥ Firewall Subnet (10.0.2.0/24)"]
                AzureFirewall["ğŸ”¥ Azure Firewall Premium<br/>IDPS + Threat Intelligence"]
                NATGateway["ğŸšª NAT Gateway<br/>ì•„ì›ƒë°”ìš´ë“œ ì „ìš©"]
            end
            
            %% ê´€ë¦¬ ì ‘ê·¼
            subgraph ManagementSubnet["âš™ï¸ Management Subnet (10.0.3.0/24)"]
                Bastion["ğŸ” Azure Bastion<br/>ì•ˆì „í•œ ê´€ë¦¬ ì ‘ê·¼"]
            end
        end
        
        %% Spoke VNet - ì• í”Œë¦¬ì¼€ì´ì…˜ ì›Œí¬ë¡œë“œ
        subgraph SpokeVNet["ğŸ¯ Spoke VNet (10.1.0.0/16)"]
            
            %% AKS í´ëŸ¬ìŠ¤í„° ì„œë¸Œë„·
            subgraph AKSSubnet["âš™ï¸ AKS Subnet (10.1.1.0/24)"]
                subgraph AKSCluster["ğŸ”§ AKS Premium Cluster (Multi-Zone)"]
                    
                    %% Node Pools
                    subgraph NodePools["ğŸ“¦ Node Pools"]
                        SystemNodes["ğŸ”§ System Nodes<br/>(Zone 1,2,3)"]
                        AppNodes["ğŸš€ App Nodes<br/>(Zone 1,2,3)"]
                    end
                    
                    %% ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ (ê³ ê°€ìš©ì„±)
                    subgraph MicroServices["ğŸš€ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ (HA)"]
                        UserService["ğŸ‘¤ User Service<br/>3 replicas + HPA"]
                        TripService["ğŸ—ºï¸ Trip Service<br/>3 replicas + HPA"]
                        AIService["ğŸ¤– AI Service<br/>2 replicas + HPA"]
                        LocationService["ğŸ“ Location Service<br/>2 replicas + HPA"]
                    end
                end
            end
            
            %% ë°ì´í„°ë² ì´ìŠ¤ ì„œë¸Œë„·
            subgraph DatabaseSubnet["ğŸ—„ï¸ Database Subnet (10.1.2.0/24)"]
                subgraph PostgreSQLHA["ğŸ˜ PostgreSQL Flexible Server (HA)"]
                    PGPrimary["ğŸ“Š Primary DB (Zone 1)"]
                    PGReplica1["ğŸ“– Read Replica (Zone 2)"]
                    PGReplica2["ğŸ“– Read Replica (Zone 3)"]
                    PGBackup["ğŸ’¾ Automated Backup<br/>35ì¼ ë³´ì¡´"]
                end
            end
            
            %% ìºì‹œ ì„œë¸Œë„·
            subgraph CacheSubnet["âš¡ Cache Subnet (10.1.3.0/24)"]
                subgraph RedisHA["ğŸ”´ Redis Premium (HA)"]
                    RedisPrimary["âš¡ Primary Cache (Zone 1)"]
                    RedisSecondary["âš¡ Secondary Cache (Zone 2)"]
                    RedisCluster["ğŸ”— Redis Cluster (3 Shards)"]
                end
            end
            
            %% Private Endpoint ì„œë¸Œë„·
            subgraph PrivateEndpoints["ğŸ”’ Private Endpoints (10.1.4.0/24)"]
                PGEndpoint["ğŸ” PostgreSQL Private Endpoint"]
                RedisEndpoint["ğŸ” Redis Private Endpoint"]
                SBEndpoint["ğŸ” Service Bus Private Endpoint"]
                KVEndpoint["ğŸ” Key Vault Private Endpoint"]
            end
        end
        
        %% ê´€ë¦¬í˜• ì„œë¹„ìŠ¤
        subgraph ManagedServices["ğŸ› ï¸ Azure ê´€ë¦¬í˜• ì„œë¹„ìŠ¤"]
            
            subgraph ServiceBusPremium["ğŸ“¨ Service Bus Premium"]
                ServiceBus["ğŸ“® sb-tripgen-prod"]
                subgraph Queues["ğŸ“¬ ë©”ì‹œì§€ í"]
                    AIQueue["ğŸ¤– ai-schedule-generation"]
                    LocationQueue["ğŸ“ location-search"]
                    NotificationQueue["ğŸ”” notification"]
                end
            end
            
            subgraph KeyVaultPremium["ğŸ” Key Vault Premium"]
                KeyVault["ğŸ—ï¸ kv-tripgen-prod<br/>HSM ë³´í˜¸"]
                Secrets["ğŸ”’ ì¸ì¦ì„œ & ë¹„ë°€"]
            end
            
            subgraph MonitoringServices["ğŸ“Š ëª¨ë‹ˆí„°ë§ ì„œë¹„ìŠ¤"]
                LogAnalytics["ğŸ“Š Log Analytics"]
                AppInsights["ğŸ“ˆ Application Insights"]
                ContainerRegistry["ğŸ“¦ Container Registry"]
            end
        end
    end
    
    %% ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ í”Œë¡œìš°

    %% ì™¸ë¶€ â†’ ë‚´ë¶€ íŠ¸ë˜í”½ (ì¸ê·¸ë ˆìŠ¤)
    Users -->|"HTTPS:443<br/>ê¸€ë¡œë²Œ ê°€ì†"| AFD
    AttackSources -.->|"ì•…ì„± íŠ¸ë˜í”½<br/>(ì°¨ë‹¨)"| DDoSProtection
    AFD -->|"WAF í•„í„°ë§<br/>Bot ì°¨ë‹¨"| PublicIP
    
    %% Application Gateway ë³´ì•ˆ ì²˜ë¦¬
    PublicIP --> WAF
    WAF -->|"OWASP ê·œì¹™ ì ìš©<br/>ìœ„í˜‘ ì°¨ë‹¨"| SSLTermination
    SSLTermination -->|"TLS 1.3 ì¢…ë£Œ<br/>ì•”í˜¸í™” í•´ì œ"| AzureFirewall
    
    %% Azure Firewall ë¼ìš°íŒ…
    AzureFirewall -->|"IDPS ê²€ì‚¬<br/>/api/users/**"| UserService
    AzureFirewall -->|"ìœ„í˜‘ ì°¨ë‹¨<br/>/api/trips/**"| TripService
    AzureFirewall -->|"ë¼ìš°íŒ…<br/>/api/ai/**"| AIService
    AzureFirewall -->|"ë¼ìš°íŒ…<br/>/api/locations/**"| LocationService
    
    %% ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ê°„ í†µì‹ 
    UserService <-->|"ë‚´ë¶€ REST API:8080"| TripService
    TripService <-->|"ë‚´ë¶€ REST API:8080"| AIService
    AIService <-->|"ë‚´ë¶€ REST API:8080"| LocationService
    
    %% Private Link ì—°ê²° (ë°ì´í„°ë² ì´ìŠ¤)
    UserService -->|"Private Link<br/>ì•”í˜¸í™” TLS:5432"| PGEndpoint
    TripService -->|"Private Link<br/>ì•”í˜¸í™” TLS:5432"| PGEndpoint
    AIService -->|"Private Link<br/>ì•”í˜¸í™” TLS:5432"| PGEndpoint
    LocationService -->|"Private Link<br/>ì•”í˜¸í™” TLS:5432"| PGEndpoint
    
    PGEndpoint --> PGPrimary
    PGEndpoint --> PGReplica1
    PGEndpoint --> PGReplica2
    
    %% Private Link ì—°ê²° (ìºì‹œ)
    UserService -->|"Private Link<br/>ì•”í˜¸í™” TLS:6379"| RedisEndpoint
    TripService -->|"Private Link<br/>ì•”í˜¸í™” TLS:6379"| RedisEndpoint
    AIService -->|"Private Link<br/>ì•”í˜¸í™” TLS:6379"| RedisEndpoint
    LocationService -->|"Private Link<br/>ì•”í˜¸í™” TLS:6379"| RedisEndpoint
    
    RedisEndpoint --> RedisPrimary
    RedisEndpoint --> RedisSecondary
    
    %% Private Link ì—°ê²° (ë©”ì‹œì§•)
    AIService -->|"Private Link<br/>AMQP/TLS:5671"| SBEndpoint
    LocationService -->|"Private Link<br/>AMQP/TLS:5671"| SBEndpoint
    TripService -->|"Private Link<br/>AMQP/TLS:5671"| SBEndpoint
    
    SBEndpoint --> ServiceBus
    ServiceBus --> AIQueue
    ServiceBus --> LocationQueue
    ServiceBus --> NotificationQueue
    
    %% Private Link ì—°ê²° (Key Vault)
    UserService -->|"Private Link<br/>HTTPS:443"| KVEndpoint
    TripService -->|"Private Link<br/>HTTPS:443"| KVEndpoint
    AIService -->|"Private Link<br/>HTTPS:443"| KVEndpoint
    LocationService -->|"Private Link<br/>HTTPS:443"| KVEndpoint
    
    KVEndpoint --> KeyVault
    KeyVault --> Secrets
    
    %% ê³ ê°€ìš©ì„± ë³µì œ
    PGPrimary -.->|"ë¹„ë™ê¸° ë³µì œ<br/>Multi-Zone"| PGReplica1
    PGPrimary -.->|"ë¹„ë™ê¸° ë³µì œ<br/>Multi-Zone"| PGReplica2
    PGPrimary -.->|"ìë™ ë°±ì—…<br/>Point-in-Time"| PGBackup
    
    RedisPrimary -.->|"HA ë™ê¸°í™”<br/>ìë™ í˜ì¼ì˜¤ë²„"| RedisSecondary
    RedisPrimary -.->|"ìƒ¤ë”©"| RedisCluster
    
    %% ì•„ì›ƒë°”ìš´ë“œ íŠ¸ë˜í”½
    UserService -.->|"ì™¸ë¶€ API í˜¸ì¶œ"| NATGateway
    AIService -.->|"AI ëª¨ë¸ API"| NATGateway
    LocationService -.->|"ìœ„ì¹˜ ì„œë¹„ìŠ¤ API"| NATGateway
    NATGateway -.->|"ì•„ì›ƒë°”ìš´ë“œ ì „ìš©"| Internet
    
    %% ê´€ë¦¬ ì ‘ê·¼
    Bastion -->|"ì•ˆì „í•œ SSH/RDP<br/>ê´€ë¦¬ ì ‘ê·¼"| AKSCluster
    
    %% ëª¨ë‹ˆí„°ë§ & ë¡œê¹…
    MicroServices -->|"ë¡œê·¸ & ë©”íŠ¸ë¦­"| LogAnalytics
    MicroServices -->|"APM"| AppInsights
    AKSCluster -->|"ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€"| ContainerRegistry
    
    %% Pod ë°°ì¹˜ (Multi-Zone)
    UserService -.->|"ë°°ì¹˜"| AppNodes
    TripService -.->|"ë°°ì¹˜"| AppNodes
    AIService -.->|"ë°°ì¹˜"| AppNodes
    LocationService -.->|"ë°°ì¹˜"| AppNodes
    
    %% ìŠ¤íƒ€ì¼ ì •ì˜
    classDef internetStyle fill:#FF6B6B,stroke:#fff,stroke-width:2px,color:#fff
    classDef securityStyle fill:#E83E8C,stroke:#fff,stroke-width:2px,color:#fff
    classDef azureStyle fill:#0078D4,stroke:#fff,stroke-width:2px,color:#fff
    classDef networkStyle fill:#1E90FF,stroke:#fff,stroke-width:2px,color:#fff
    classDef k8sStyle fill:#326CE5,stroke:#fff,stroke-width:2px,color:#fff
    classDef appStyle fill:#28A745,stroke:#fff,stroke-width:2px,color:#fff
    classDef dataStyle fill:#DC3545,stroke:#fff,stroke-width:2px,color:#fff
    classDef cacheStyle fill:#FF6B35,stroke:#fff,stroke-width:2px,color:#fff
    classDef messageStyle fill:#FD7E14,stroke:#fff,stroke-width:2px,color:#fff
    classDef managedStyle fill:#17A2B8,stroke:#fff,stroke-width:2px,color:#fff
    classDef privateStyle fill:#6C757D,stroke:#fff,stroke-width:2px,color:#fff
    
    %% ìŠ¤íƒ€ì¼ ì ìš©
    class Internet,Users,AttackSources internetStyle
    class GlobalSecurity,AFD,DDoSProtection,AppGateway,PublicIP,WAF,SSLTermination,AzureFirewall,Bastion securityStyle
    class AzureCloud azureStyle
    class HubVNet,SpokeVNet,DMZSubnet,FirewallSubnet,ManagementSubnet,AKSSubnet,DatabaseSubnet,CacheSubnet networkStyle
    class AKSCluster,NodePools,SystemNodes,AppNodes k8sStyle
    class MicroServices,UserService,TripService,AIService,LocationService appStyle
    class PostgreSQLHA,PGPrimary,PGReplica1,PGReplica2,PGBackup dataStyle
    class RedisHA,RedisPrimary,RedisSecondary,RedisCluster cacheStyle
    class ServiceBusPremium,ServiceBus,Queues,AIQueue,LocationQueue,NotificationQueue messageStyle
    class ManagedServices,KeyVaultPremium,KeyVault,Secrets,MonitoringServices,LogAnalytics,AppInsights,ContainerRegistry managedStyle
    class PrivateEndpoints,PGEndpoint,RedisEndpoint,SBEndpoint,KVEndpoint,NATGateway privateStyle